"""initial_schema

Revision ID: af8fbbefa221
Revises: 
Create Date: 2026-01-27 10:40:21.918754

"""

from alembic import op
import sqlalchemy as sa
import geoalchemy2
from sqlalchemy.dialects import postgresql

revision = 'af8fbbefa221'
down_revision = None
branch_labels = None
depends_on = None


def upgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_table('audit_events',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('occurred_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('actor_type', sa.Enum('system', 'user', 'api_key', 'service', name='auditactortype'), nullable=False),
    sa.Column('actor_id', sa.String(length=120), nullable=True),
    sa.Column('action', sa.String(length=80), nullable=False),
    sa.Column('entity_type', sa.String(length=160), nullable=False),
    sa.Column('entity_id', sa.String(length=120), nullable=True),
    sa.Column('status_code', sa.Integer(), nullable=False),
    sa.Column('is_success', sa.Boolean(), nullable=False),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('ip_address', sa.String(length=64), nullable=True),
    sa.Column('user_agent', sa.String(length=255), nullable=True),
    sa.Column('request_id', sa.String(length=120), nullable=True),
    sa.Column('metadata', sa.JSON(), nullable=True),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('bandwidth_samples',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('subscription_id', sa.UUID(), nullable=False),
    sa.Column('device_id', sa.UUID(), nullable=True),
    sa.Column('interface_id', sa.UUID(), nullable=True),
    sa.Column('rx_bps', sa.Integer(), nullable=False),
    sa.Column('tx_bps', sa.Integer(), nullable=False),
    sa.Column('sample_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('billing_rates',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('name', sa.String(length=160), nullable=False),
    sa.Column('hourly_rate', sa.Numeric(precision=12, scale=2), nullable=False),
    sa.Column('currency', sa.String(length=3), nullable=False),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('connector_configs',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('name', sa.String(length=160), nullable=False),
    sa.Column('connector_type', sa.Enum('webhook', 'http', 'email', 'whatsapp', 'smtp', 'stripe', 'twilio', 'facebook', 'instagram', 'custom', name='connectortype'), nullable=False),
    sa.Column('base_url', sa.String(length=500), nullable=True),
    sa.Column('auth_type', sa.Enum('none', 'basic', 'bearer', 'hmac', 'api_key', 'oauth2', name='connectorauthtype'), nullable=False),
    sa.Column('auth_config', sa.JSON(), nullable=True),
    sa.Column('headers', sa.JSON(), nullable=True),
    sa.Column('retry_policy', sa.JSON(), nullable=True),
    sa.Column('timeout_sec', sa.Integer(), nullable=True),
    sa.Column('metadata', sa.JSON(), nullable=True),
    sa.Column('notes', sa.Text(), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('name', name='uq_connector_configs_name')
    )
    op.create_table('coverage_areas',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('name', sa.String(length=160), nullable=False),
    sa.Column('code', sa.String(length=80), nullable=True),
    sa.Column('zone_key', sa.String(length=80), nullable=True),
    sa.Column('buildout_status', sa.Enum('planned', 'in_progress', 'ready', 'not_planned', name='buildoutstatus'), nullable=False),
    sa.Column('buildout_window', sa.String(length=120), nullable=True),
    sa.Column('serviceable', sa.Boolean(), nullable=False),
    sa.Column('priority', sa.Integer(), nullable=False),
    sa.Column('geometry_geojson', sa.JSON(), nullable=False),
    sa.Column('geom', geoalchemy2.types.Geometry(srid=4326, from_text='ST_GeomFromEWKT', name='geometry'), nullable=True),
    sa.Column('min_latitude', sa.Float(), nullable=True),
    sa.Column('max_latitude', sa.Float(), nullable=True),
    sa.Column('min_longitude', sa.Float(), nullable=True),
    sa.Column('max_longitude', sa.Float(), nullable=True),
    sa.Column('constraints', sa.JSON(), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.PrimaryKeyConstraint('id')
    )
    # Index auto-created by GeoAlchemy2 for Geometry column
    # # op.create_index('idx_.*_geom', 'coverage_areas', ['geom'], unique=False, postgresql_using='gist')
    op.create_table('crm_pipelines',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('name', sa.String(length=160), nullable=False),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('metadata', sa.JSON(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('crm_social_comment_replies',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('comment_id', sa.UUID(), nullable=False),
    sa.Column('platform', sa.Enum('facebook', 'instagram', name='socialcommentplatform'), nullable=False),
    sa.Column('external_id', sa.String(length=200), nullable=True),
    sa.Column('message', sa.Text(), nullable=False),
    sa.Column('created_time', sa.DateTime(timezone=True), nullable=True),
    sa.Column('raw_payload', postgresql.JSON(astext_type=sa.Text()), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('platform', 'external_id', name='uq_crm_social_comment_replies_platform_external')
    )
    op.create_table('crm_social_comments',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('platform', sa.Enum('facebook', 'instagram', name='socialcommentplatform'), nullable=False),
    sa.Column('external_id', sa.String(length=200), nullable=False),
    sa.Column('external_post_id', sa.String(length=200), nullable=True),
    sa.Column('source_account_id', sa.String(length=200), nullable=True),
    sa.Column('author_id', sa.String(length=200), nullable=True),
    sa.Column('author_name', sa.String(length=200), nullable=True),
    sa.Column('message', sa.Text(), nullable=True),
    sa.Column('created_time', sa.DateTime(timezone=True), nullable=True),
    sa.Column('permalink_url', sa.String(length=500), nullable=True),
    sa.Column('raw_payload', postgresql.JSON(astext_type=sa.Text()), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('platform', 'external_id', name='uq_crm_social_comments_platform_external')
    )
    op.create_table('crm_teams',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('name', sa.String(length=160), nullable=False),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('notes', sa.String(length=255), nullable=True),
    sa.Column('metadata', sa.JSON(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('customer_notification_events',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('entity_type', sa.String(length=40), nullable=False),
    sa.Column('entity_id', sa.UUID(), nullable=False),
    sa.Column('channel', sa.String(length=40), nullable=False),
    sa.Column('recipient', sa.String(length=255), nullable=False),
    sa.Column('message', sa.Text(), nullable=False),
    sa.Column('status', sa.Enum('pending', 'sent', 'failed', name='customernotificationstatus'), nullable=False),
    sa.Column('sent_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('dispatch_rules',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('name', sa.String(length=160), nullable=False),
    sa.Column('priority', sa.Integer(), nullable=False),
    sa.Column('work_type', sa.String(length=40), nullable=True),
    sa.Column('work_priority', sa.String(length=40), nullable=True),
    sa.Column('region', sa.String(length=120), nullable=True),
    sa.Column('skill_ids', sa.JSON(), nullable=True),
    sa.Column('auto_assign', sa.Boolean(), nullable=False),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('document_sequences',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('key', sa.String(length=80), nullable=False),
    sa.Column('next_value', sa.Integer(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('key', name='uq_document_sequences_key')
    )
    op.create_table('domain_settings',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('domain', sa.Enum('auth', 'audit', 'billing', 'catalog', 'subscriber', 'imports', 'notification', 'network', 'network_monitoring', 'provisioning', 'geocoding', 'usage', 'radius', 'collections', 'lifecycle', 'projects', 'workflow', 'inventory', 'comms', 'tr069', 'snmp', 'bandwidth', 'subscription_engine', 'gis', 'scheduler', name='settingdomain'), nullable=False),
    sa.Column('key', sa.String(length=120), nullable=False),
    sa.Column('value_type', sa.Enum('string', 'integer', 'boolean', 'decimal', 'json', name='settingvaluetype'), nullable=False),
    sa.Column('value_text', sa.Text(), nullable=True),
    sa.Column('value_json', sa.JSON(none_as_null=True), nullable=True),
    sa.Column('is_secret', sa.Boolean(), nullable=False),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.CheckConstraint("(value_type = 'json' AND value_json IS NOT NULL AND value_text IS NULL) OR (value_type != 'json' AND value_text IS NOT NULL)", name='ck_domain_settings_value_alignment'),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('domain', 'key', name='uq_domain_settings_domain_key')
    )
    op.create_table('event_store',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('event_id', sa.UUID(), nullable=False),
    sa.Column('event_type', sa.String(length=100), nullable=False),
    sa.Column('payload', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.Column('status', sa.Enum('pending', 'processing', 'completed', 'failed', name='eventstatus'), nullable=False),
    sa.Column('retry_count', sa.Integer(), nullable=False),
    sa.Column('error', sa.Text(), nullable=True),
    sa.Column('processed_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('actor', sa.String(length=255), nullable=True),
    sa.Column('subscriber_id', sa.UUID(), nullable=True),
    sa.Column('account_id', sa.UUID(), nullable=True),
    sa.Column('subscription_id', sa.UUID(), nullable=True),
    sa.Column('invoice_id', sa.UUID(), nullable=True),
    sa.Column('ticket_id', sa.UUID(), nullable=True),
    sa.Column('service_order_id', sa.UUID(), nullable=True),
    sa.Column('failed_handlers', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_event_store_account_id'), 'event_store', ['account_id'], unique=False)
    op.create_index(op.f('ix_event_store_event_id'), 'event_store', ['event_id'], unique=True)
    op.create_index(op.f('ix_event_store_event_type'), 'event_store', ['event_type'], unique=False)
    op.create_index(op.f('ix_event_store_status'), 'event_store', ['status'], unique=False)
    op.create_index(op.f('ix_event_store_subscriber_id'), 'event_store', ['subscriber_id'], unique=False)
    op.create_table('fdh_cabinets',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('name', sa.String(length=160), nullable=False),
    sa.Column('code', sa.String(length=80), nullable=True),
    sa.Column('latitude', sa.Float(), nullable=True),
    sa.Column('longitude', sa.Float(), nullable=True),
    sa.Column('geom', geoalchemy2.types.Geometry(geometry_type='POINT', srid=4326, from_text='ST_GeomFromEWKT', name='geometry'), nullable=True),
    sa.Column('notes', sa.Text(), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('code', name='uq_fdh_cabinets_code')
    )
    # op.create_index('idx_.*_geom', 'fdh_cabinets', ['geom'], unique=False, postgresql_using='gist')
    op.create_table('fiber_access_points',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('code', sa.String(length=60), nullable=True),
    sa.Column('name', sa.String(length=160), nullable=False),
    sa.Column('access_point_type', sa.String(length=60), nullable=True),
    sa.Column('placement', sa.String(length=60), nullable=True),
    sa.Column('latitude', sa.Float(), nullable=True),
    sa.Column('longitude', sa.Float(), nullable=True),
    sa.Column('geom', geoalchemy2.types.Geometry(geometry_type='POINT', srid=4326, from_text='ST_GeomFromEWKT', name='geometry'), nullable=True),
    sa.Column('street', sa.String(length=200), nullable=True),
    sa.Column('city', sa.String(length=100), nullable=True),
    sa.Column('county', sa.String(length=100), nullable=True),
    sa.Column('state', sa.String(length=60), nullable=True),
    sa.Column('notes', sa.Text(), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('code')
    )
    # op.create_index('idx_.*_geom', 'fiber_access_points', ['geom'], unique=False, postgresql_using='gist')
    op.create_table('fiber_splice_closures',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('name', sa.String(length=160), nullable=False),
    sa.Column('latitude', sa.Float(), nullable=True),
    sa.Column('longitude', sa.Float(), nullable=True),
    sa.Column('geom', geoalchemy2.types.Geometry(geometry_type='POINT', srid=4326, from_text='ST_GeomFromEWKT', name='geometry'), nullable=True),
    sa.Column('notes', sa.Text(), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.PrimaryKeyConstraint('id')
    )
    # op.create_index('idx_.*_geom', 'fiber_splice_closures', ['geom'], unique=False, postgresql_using='gist')
    op.create_table('fiber_strands',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('cable_name', sa.String(length=160), nullable=False),
    sa.Column('strand_number', sa.Integer(), nullable=False),
    sa.Column('label', sa.String(length=160), nullable=True),
    sa.Column('status', sa.Enum('available', 'in_use', 'reserved', 'damaged', 'retired', name='fiberstrandstatus'), nullable=False),
    sa.Column('upstream_type', sa.Enum('olt_port', 'splitter_port', 'fdh', 'ont', 'splice_closure', 'other', name='fiberendpointtype'), nullable=True),
    sa.Column('upstream_id', sa.UUID(), nullable=True),
    sa.Column('downstream_type', sa.Enum('olt_port', 'splitter_port', 'fdh', 'ont', 'splice_closure', 'other', name='fiberendpointtype'), nullable=True),
    sa.Column('downstream_id', sa.UUID(), nullable=True),
    sa.Column('notes', sa.Text(), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('cable_name', 'strand_number', name='uq_fiber_strands_cable_strand')
    )
    op.create_table('fiber_termination_points',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('name', sa.String(length=160), nullable=True),
    sa.Column('endpoint_type', sa.Enum('fdh', 'splitter', 'splitter_port', 'pon_port', 'olt_port', 'ont', 'terminal', 'splice_closure', 'other', name='odnendpointtype'), nullable=False),
    sa.Column('ref_id', sa.UUID(), nullable=True),
    sa.Column('latitude', sa.Float(), nullable=True),
    sa.Column('longitude', sa.Float(), nullable=True),
    sa.Column('notes', sa.Text(), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('geo_areas',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('name', sa.String(length=160), nullable=False),
    sa.Column('area_type', sa.Enum('coverage', 'service_area', 'region', 'custom', name='geoareatype'), nullable=False),
    sa.Column('geometry_geojson', sa.JSON(), nullable=True),
    sa.Column('geom', geoalchemy2.types.Geometry(srid=4326, from_text='ST_GeomFromEWKT', name='geometry'), nullable=True),
    sa.Column('min_latitude', sa.Float(), nullable=True),
    sa.Column('min_longitude', sa.Float(), nullable=True),
    sa.Column('max_latitude', sa.Float(), nullable=True),
    sa.Column('max_longitude', sa.Float(), nullable=True),
    sa.Column('metadata', sa.JSON(), nullable=True),
    sa.Column('tags', sa.JSON(), nullable=True),
    sa.Column('notes', sa.Text(), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.PrimaryKeyConstraint('id')
    )
    # op.create_index('idx_.*_geom', 'geo_areas', ['geom'], unique=False, postgresql_using='gist')
    op.create_table('geo_layers',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('name', sa.String(length=160), nullable=False),
    sa.Column('layer_key', sa.String(length=80), nullable=False),
    sa.Column('layer_type', sa.Enum('points', 'lines', 'polygons', 'heatmap', 'cluster', name='geolayertype'), nullable=False),
    sa.Column('source_type', sa.Enum('locations', 'areas', name='geolayersource'), nullable=False),
    sa.Column('style', sa.JSON(), nullable=True),
    sa.Column('filters', sa.JSON(), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('layer_key', name='uq_geo_layers_layer_key')
    )
    op.create_table('geo_locations',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('name', sa.String(length=160), nullable=False),
    sa.Column('location_type', sa.Enum('address', 'pop', 'site', 'customer', 'asset', 'custom', name='geolocationtype'), nullable=False),
    sa.Column('latitude', sa.Float(), nullable=False),
    sa.Column('longitude', sa.Float(), nullable=False),
    sa.Column('geom', geoalchemy2.types.Geometry(geometry_type='POINT', srid=4326, from_text='ST_GeomFromEWKT', name='geometry'), nullable=True),
    sa.Column('address_id', sa.UUID(), nullable=True),
    sa.Column('pop_site_id', sa.UUID(), nullable=True),
    sa.Column('metadata', sa.JSON(), nullable=True),
    sa.Column('tags', sa.JSON(), nullable=True),
    sa.Column('notes', sa.Text(), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.PrimaryKeyConstraint('id')
    )
    # op.create_index('idx_.*_geom', 'geo_locations', ['geom'], unique=False, postgresql_using='gist')
    op.create_table('installation_projects',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('project_id', sa.UUID(), nullable=False),
    sa.Column('buildout_project_id', sa.UUID(), nullable=True),
    sa.Column('account_id', sa.UUID(), nullable=True),
    sa.Column('address_id', sa.UUID(), nullable=True),
    sa.Column('assigned_vendor_id', sa.UUID(), nullable=True),
    sa.Column('assignment_type', sa.Enum('bidding', 'direct', name='vendorassignmenttype'), nullable=True),
    sa.Column('status', sa.Enum('draft', 'open_for_bidding', 'quoted', 'approved', 'in_progress', 'completed', 'verified', 'assigned', name='installationprojectstatus'), nullable=False),
    sa.Column('bidding_open_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('bidding_close_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('approved_quote_id', sa.UUID(), nullable=True),
    sa.Column('created_by_person_id', sa.UUID(), nullable=True),
    sa.Column('notes', sa.Text(), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['approved_quote_id'], ['project_quotes.id'], ),
    sa.ForeignKeyConstraint(['assigned_vendor_id'], ['vendors.id'], ),
    sa.ForeignKeyConstraint(['buildout_project_id'], ['buildout_projects.id'], ),
    sa.ForeignKeyConstraint(['created_by_person_id'], ['people.id'], ),
    sa.ForeignKeyConstraint(['project_id'], ['projects.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('project_id', name='uq_installation_projects_project')
    )
    op.create_table('inventory_items',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('sku', sa.String(length=80), nullable=True),
    sa.Column('name', sa.String(length=160), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('unit', sa.String(length=40), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('inventory_locations',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('name', sa.String(length=160), nullable=False),
    sa.Column('code', sa.String(length=80), nullable=True),
    sa.Column('address_id', sa.UUID(), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('kpi_aggregates',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('key', sa.String(length=120), nullable=False),
    sa.Column('period_start', sa.DateTime(timezone=True), nullable=False),
    sa.Column('period_end', sa.DateTime(timezone=True), nullable=False),
    sa.Column('value', sa.Numeric(precision=14, scale=4), nullable=False),
    sa.Column('metadata', sa.JSON(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('kpi_configs',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('key', sa.String(length=120), nullable=False),
    sa.Column('name', sa.String(length=160), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('parameters', sa.JSON(), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('legal_documents',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('document_type', sa.Enum('terms_of_service', 'privacy_policy', 'acceptable_use', 'service_level_agreement', 'data_processing', 'cookie_policy', 'refund_policy', 'other', name='legaldocumenttype'), nullable=False),
    sa.Column('title', sa.String(length=200), nullable=False),
    sa.Column('slug', sa.String(length=100), nullable=False),
    sa.Column('version', sa.String(length=20), nullable=False),
    sa.Column('summary', sa.Text(), nullable=True),
    sa.Column('content', sa.Text(), nullable=True),
    sa.Column('file_path', sa.String(length=500), nullable=True),
    sa.Column('file_name', sa.String(length=255), nullable=True),
    sa.Column('file_size', sa.Integer(), nullable=True),
    sa.Column('mime_type', sa.String(length=100), nullable=True),
    sa.Column('is_current', sa.Boolean(), nullable=False),
    sa.Column('is_published', sa.Boolean(), nullable=False),
    sa.Column('published_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('effective_date', sa.DateTime(timezone=True), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('slug')
    )
    op.create_table('notification_templates',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('name', sa.String(length=120), nullable=False),
    sa.Column('code', sa.String(length=120), nullable=False),
    sa.Column('channel', sa.Enum('email', 'sms', 'push', 'whatsapp', 'webhook', name='notificationchannel'), nullable=False),
    sa.Column('subject', sa.String(length=200), nullable=True),
    sa.Column('body', sa.Text(), nullable=False),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('code')
    )
    op.create_table('olt_devices',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('name', sa.String(length=160), nullable=False),
    sa.Column('hostname', sa.String(length=160), nullable=True),
    sa.Column('mgmt_ip', sa.String(length=64), nullable=True),
    sa.Column('vendor', sa.String(length=120), nullable=True),
    sa.Column('model', sa.String(length=120), nullable=True),
    sa.Column('serial_number', sa.String(length=120), nullable=True),
    sa.Column('notes', sa.Text(), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('hostname', name='uq_olt_devices_hostname'),
    sa.UniqueConstraint('mgmt_ip', name='uq_olt_devices_mgmt_ip')
    )
    op.create_table('on_call_rotations',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('name', sa.String(length=160), nullable=False),
    sa.Column('timezone', sa.String(length=60), nullable=False),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('notes', sa.Text(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('name', name='uq_on_call_rotations_name')
    )
    op.create_table('ont_units',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('serial_number', sa.String(length=120), nullable=False),
    sa.Column('model', sa.String(length=120), nullable=True),
    sa.Column('vendor', sa.String(length=120), nullable=True),
    sa.Column('firmware_version', sa.String(length=120), nullable=True),
    sa.Column('notes', sa.Text(), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('serial_number', name='uq_ont_units_serial_number')
    )
    op.create_table('organizations',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('name', sa.String(length=160), nullable=False),
    sa.Column('legal_name', sa.String(length=200), nullable=True),
    sa.Column('tax_id', sa.String(length=80), nullable=True),
    sa.Column('domain', sa.String(length=120), nullable=True),
    sa.Column('website', sa.String(length=255), nullable=True),
    sa.Column('address_line1', sa.String(length=120), nullable=True),
    sa.Column('address_line2', sa.String(length=120), nullable=True),
    sa.Column('city', sa.String(length=80), nullable=True),
    sa.Column('region', sa.String(length=80), nullable=True),
    sa.Column('postal_code', sa.String(length=20), nullable=True),
    sa.Column('country_code', sa.String(length=2), nullable=True),
    sa.Column('notes', sa.Text(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('permissions',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('key', sa.String(length=120), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('key', name='uq_permissions_key')
    )
    op.create_table('project_quotes',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('project_id', sa.UUID(), nullable=False),
    sa.Column('vendor_id', sa.UUID(), nullable=False),
    sa.Column('status', sa.Enum('draft', 'submitted', 'under_review', 'approved', 'rejected', 'revision_requested', name='projectquotestatus'), nullable=False),
    sa.Column('currency', sa.String(length=3), nullable=False),
    sa.Column('subtotal', sa.Numeric(precision=12, scale=2), nullable=False),
    sa.Column('tax_total', sa.Numeric(precision=12, scale=2), nullable=False),
    sa.Column('total', sa.Numeric(precision=12, scale=2), nullable=False),
    sa.Column('valid_from', sa.DateTime(timezone=True), nullable=True),
    sa.Column('valid_until', sa.DateTime(timezone=True), nullable=True),
    sa.Column('submitted_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('reviewed_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('reviewed_by_person_id', sa.UUID(), nullable=True),
    sa.Column('review_notes', sa.Text(), nullable=True),
    sa.Column('created_by_person_id', sa.UUID(), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['created_by_person_id'], ['people.id'], ),
    sa.ForeignKeyConstraint(['project_id'], ['installation_projects.id'], ),
    sa.ForeignKeyConstraint(['reviewed_by_person_id'], ['people.id'], ),
    sa.ForeignKeyConstraint(['vendor_id'], ['vendors.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('project_task_status_transitions',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('from_status', sa.String(length=40), nullable=False),
    sa.Column('to_status', sa.String(length=40), nullable=False),
    sa.Column('requires_note', sa.Boolean(), nullable=False),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('project_templates',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('name', sa.String(length=160), nullable=False),
    sa.Column('project_type', sa.Enum('cable_rerun', 'fiber_optics_relocation', 'radio_fiber_relocation', 'fiber_optics_installation', 'radio_installation', name='projecttype'), nullable=True),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('project_type', name='uq_project_templates_project_type')
    )
    op.create_table('provisioning_workflows',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('name', sa.String(length=160), nullable=False),
    sa.Column('vendor', sa.Enum('mikrotik', 'huawei', 'zte', 'nokia', 'genieacs', 'other', name='provisioningvendor'), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('queue_mappings',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('nas_device_id', sa.UUID(), nullable=False),
    sa.Column('queue_name', sa.String(length=255), nullable=False),
    sa.Column('subscription_id', sa.UUID(), nullable=False),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('nas_device_id', 'queue_name', name='uq_queue_mappings_device_queue')
    )
    op.create_table('resellers',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('name', sa.String(length=160), nullable=False),
    sa.Column('code', sa.String(length=60), nullable=True),
    sa.Column('contact_email', sa.String(length=255), nullable=True),
    sa.Column('contact_phone', sa.String(length=40), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('notes', sa.Text(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('code')
    )
    op.create_table('roles',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('name', sa.String(length=80), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('name', name='uq_roles_name')
    )
    op.create_table('scheduled_tasks',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('name', sa.String(length=160), nullable=False),
    sa.Column('task_name', sa.String(length=200), nullable=False),
    sa.Column('schedule_type', sa.Enum('interval', name='scheduletype'), nullable=False),
    sa.Column('interval_seconds', sa.Integer(), nullable=False),
    sa.Column('args_json', sa.JSON(), nullable=True),
    sa.Column('kwargs_json', sa.JSON(), nullable=True),
    sa.Column('enabled', sa.Boolean(), nullable=False),
    sa.Column('last_run_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('service_buildings',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('code', sa.String(length=60), nullable=True),
    sa.Column('name', sa.String(length=200), nullable=False),
    sa.Column('clli', sa.String(length=20), nullable=True),
    sa.Column('latitude', sa.Float(), nullable=True),
    sa.Column('longitude', sa.Float(), nullable=True),
    sa.Column('geom', geoalchemy2.types.Geometry(geometry_type='POINT', srid=4326, from_text='ST_GeomFromEWKT', name='geometry'), nullable=True),
    sa.Column('boundary_geom', geoalchemy2.types.Geometry(geometry_type='POLYGON', srid=4326, from_text='ST_GeomFromEWKT', name='geometry'), nullable=True),
    sa.Column('street', sa.String(length=200), nullable=True),
    sa.Column('city', sa.String(length=100), nullable=True),
    sa.Column('state', sa.String(length=60), nullable=True),
    sa.Column('zip_code', sa.String(length=20), nullable=True),
    sa.Column('work_order', sa.String(length=100), nullable=True),
    sa.Column('notes', sa.Text(), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('code')
    )
    # op.create_index('idx_.*_geom', 'service_buildings', ['boundary_geom'], unique=False, postgresql_using='gist')
    # op.create_index('idx_.*_geom', 'service_buildings', ['geom'], unique=False, postgresql_using='gist')
    op.create_table('skills',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('name', sa.String(length=120), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('sla_policies',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('name', sa.String(length=160), nullable=False),
    sa.Column('entity_type', sa.Enum('ticket', 'work_order', 'project_task', name='workflowentitytype'), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('surveys',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('name', sa.String(length=160), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('questions', sa.JSON(), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('ticket_status_transitions',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('from_status', sa.String(length=40), nullable=False),
    sa.Column('to_status', sa.String(length=40), nullable=False),
    sa.Column('requires_note', sa.Boolean(), nullable=False),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('vendors',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('name', sa.String(length=160), nullable=False),
    sa.Column('code', sa.String(length=60), nullable=True),
    sa.Column('contact_name', sa.String(length=160), nullable=True),
    sa.Column('contact_email', sa.String(length=255), nullable=True),
    sa.Column('contact_phone', sa.String(length=40), nullable=True),
    sa.Column('license_number', sa.String(length=120), nullable=True),
    sa.Column('service_area', sa.Text(), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('notes', sa.Text(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('code')
    )
    op.create_table('wireguard_servers',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('name', sa.String(length=160), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('interface_name', sa.String(length=32), nullable=False),
    sa.Column('listen_port', sa.Integer(), nullable=False),
    sa.Column('private_key', sa.Text(), nullable=True),
    sa.Column('public_key', sa.String(length=64), nullable=True),
    sa.Column('public_host', sa.String(length=255), nullable=True),
    sa.Column('public_port', sa.Integer(), nullable=True),
    sa.Column('vpn_address', sa.String(length=64), nullable=False),
    sa.Column('vpn_address_v6', sa.String(length=64), nullable=True),
    sa.Column('mtu', sa.Integer(), nullable=False),
    sa.Column('dns_servers', sa.JSON(), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('metadata', sa.JSON(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('name')
    )
    op.create_table('wireless_masts',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('pop_site_id', sa.UUID(), nullable=True),
    sa.Column('name', sa.String(length=160), nullable=False),
    sa.Column('latitude', sa.Float(), nullable=False),
    sa.Column('longitude', sa.Float(), nullable=False),
    sa.Column('geom', geoalchemy2.types.Geometry(geometry_type='POINT', srid=4326, from_text='ST_GeomFromEWKT', name='geometry'), nullable=True),
    sa.Column('height_m', sa.Float(), nullable=True),
    sa.Column('structure_type', sa.String(length=80), nullable=True),
    sa.Column('owner', sa.String(length=160), nullable=True),
    sa.Column('status', sa.String(length=40), nullable=False),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('notes', sa.Text(), nullable=True),
    sa.Column('metadata', sa.JSON(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.PrimaryKeyConstraint('id')
    )
    # op.create_index('idx_.*_geom', 'wireless_masts', ['geom'], unique=False, postgresql_using='gist')
    op.create_table('work_order_status_transitions',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('from_status', sa.String(length=40), nullable=False),
    sa.Column('to_status', sa.String(length=40), nullable=False),
    sa.Column('requires_note', sa.Boolean(), nullable=False),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('alert_notification_policies',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('name', sa.String(length=160), nullable=False),
    sa.Column('channel', sa.Enum('email', 'sms', 'push', 'whatsapp', 'webhook', name='notificationchannel'), nullable=False),
    sa.Column('recipient', sa.String(length=255), nullable=False),
    sa.Column('template_id', sa.UUID(), nullable=True),
    sa.Column('severity_min', sa.Enum('info', 'warning', 'critical', 'emergency', name='alertseverity'), nullable=False),
    sa.Column('status', sa.Enum('open', 'acknowledged', 'resolved', name='alertstatus'), nullable=False),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('notes', sa.Text(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['template_id'], ['notification_templates.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('name', name='uq_alert_notification_policies_name')
    )
    op.create_table('crm_pipeline_stages',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('pipeline_id', sa.UUID(), nullable=False),
    sa.Column('name', sa.String(length=160), nullable=False),
    sa.Column('order_index', sa.Integer(), nullable=False),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('metadata', sa.JSON(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['pipeline_id'], ['crm_pipelines.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('crm_routing_rules',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('team_id', sa.UUID(), nullable=False),
    sa.Column('channel_type', sa.Enum('email', 'whatsapp', 'facebook_messenger', 'instagram_dm', name='channeltype'), nullable=False),
    sa.Column('rule_config', sa.JSON(), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['team_id'], ['crm_teams.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('external_references',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('connector_config_id', sa.UUID(), nullable=True),
    sa.Column('entity_type', sa.Enum('ticket', 'ticket_comment', 'project', 'project_task', 'work_order', 'work_order_note', name='externalentitytype'), nullable=False),
    sa.Column('entity_id', sa.UUID(), nullable=False),
    sa.Column('external_id', sa.String(length=200), nullable=False),
    sa.Column('external_url', sa.String(length=500), nullable=True),
    sa.Column('metadata', sa.JSON(), nullable=True),
    sa.Column('last_synced_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['connector_config_id'], ['connector_configs.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('connector_config_id', 'entity_type', 'entity_id', name='uq_external_refs_connector_entity'),
    sa.UniqueConstraint('connector_config_id', 'entity_type', 'external_id', name='uq_external_refs_connector_external')
    )
    op.create_table('fiber_segments',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('name', sa.String(length=160), nullable=False),
    sa.Column('segment_type', sa.Enum('feeder', 'distribution', 'drop', name='fibersegmenttype'), nullable=False),
    sa.Column('cable_type', sa.Enum('single_mode', 'multi_mode', 'armored', 'aerial', 'underground', 'direct_buried', name='fibercabletype'), nullable=True),
    sa.Column('fiber_count', sa.Integer(), nullable=True, comment='Number of fiber cores in the cable'),
    sa.Column('from_point_id', sa.UUID(), nullable=True),
    sa.Column('to_point_id', sa.UUID(), nullable=True),
    sa.Column('fiber_strand_id', sa.UUID(), nullable=True),
    sa.Column('length_m', sa.Float(), nullable=True),
    sa.Column('route_geom', geoalchemy2.types.Geometry(geometry_type='LINESTRING', srid=4326, from_text='ST_GeomFromEWKT', name='geometry'), nullable=True),
    sa.Column('notes', sa.Text(), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['fiber_strand_id'], ['fiber_strands.id'], ),
    sa.ForeignKeyConstraint(['from_point_id'], ['fiber_termination_points.id'], ),
    sa.ForeignKeyConstraint(['to_point_id'], ['fiber_termination_points.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('name', name='uq_fiber_segments_name')
    )
    # op.create_index('idx_.*_geom', 'fiber_segments', ['route_geom'], unique=False, postgresql_using='gist')
    op.create_table('fiber_splice_trays',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('closure_id', sa.UUID(), nullable=False),
    sa.Column('tray_number', sa.Integer(), nullable=False),
    sa.Column('name', sa.String(length=160), nullable=True),
    sa.Column('notes', sa.Text(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['closure_id'], ['fiber_splice_closures.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('closure_id', 'tray_number', name='uq_fiber_splice_trays_closure_tray')
    )
    op.create_table('integration_targets',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('name', sa.String(length=160), nullable=False),
    sa.Column('target_type', sa.Enum('radius', 'crm', 'billing', 'n8n', 'custom', name='integrationtargettype'), nullable=False),
    sa.Column('connector_config_id', sa.UUID(), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('notes', sa.Text(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['connector_config_id'], ['connector_configs.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('inventory_stock',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('item_id', sa.UUID(), nullable=False),
    sa.Column('location_id', sa.UUID(), nullable=False),
    sa.Column('quantity_on_hand', sa.Integer(), nullable=False),
    sa.Column('reserved_quantity', sa.Integer(), nullable=False),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['item_id'], ['inventory_items.id'], ),
    sa.ForeignKeyConstraint(['location_id'], ['inventory_locations.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('item_id', 'location_id', name='uq_inventory_stock_item_location')
    )
    op.create_table('notifications',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('template_id', sa.UUID(), nullable=True),
    sa.Column('connector_config_id', sa.UUID(), nullable=True),
    sa.Column('channel', sa.Enum('email', 'sms', 'push', 'whatsapp', 'webhook', name='notificationchannel'), nullable=False),
    sa.Column('recipient', sa.String(length=255), nullable=False),
    sa.Column('subject', sa.String(length=200), nullable=True),
    sa.Column('body', sa.Text(), nullable=True),
    sa.Column('status', sa.Enum('queued', 'sending', 'delivered', 'failed', 'canceled', name='notificationstatus'), nullable=False),
    sa.Column('send_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('sent_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('last_error', sa.Text(), nullable=True),
    sa.Column('retry_count', sa.Integer(), nullable=False),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['connector_config_id'], ['connector_configs.id'], ),
    sa.ForeignKeyConstraint(['template_id'], ['notification_templates.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('oauth_tokens',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('connector_config_id', sa.UUID(), nullable=False),
    sa.Column('provider', sa.String(length=64), nullable=False),
    sa.Column('account_type', sa.String(length=64), nullable=False),
    sa.Column('external_account_id', sa.String(length=120), nullable=False),
    sa.Column('external_account_name', sa.String(length=255), nullable=True),
    sa.Column('access_token', sa.Text(), nullable=True),
    sa.Column('refresh_token', sa.Text(), nullable=True),
    sa.Column('token_type', sa.String(length=64), nullable=True),
    sa.Column('token_expires_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('scopes', postgresql.JSON(astext_type=sa.Text()), nullable=True),
    sa.Column('last_refreshed_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('refresh_error', sa.Text(), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('metadata', postgresql.JSON(astext_type=sa.Text()), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['connector_config_id'], ['connector_configs.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('connector_config_id', 'provider', 'external_account_id', name='uq_oauth_tokens_connector_provider_account')
    )
    op.create_index('ix_oauth_tokens_connector_config_id', 'oauth_tokens', ['connector_config_id'], unique=False)
    op.create_index('ix_oauth_tokens_provider', 'oauth_tokens', ['provider'], unique=False)
    op.create_index('ix_oauth_tokens_token_expires_at', 'oauth_tokens', ['token_expires_at'], unique=False)
    op.create_table('olt_power_units',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('olt_id', sa.UUID(), nullable=False),
    sa.Column('slot', sa.String(length=40), nullable=False),
    sa.Column('status', sa.String(length=40), nullable=True),
    sa.Column('notes', sa.Text(), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['olt_id'], ['olt_devices.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('olt_id', 'slot', name='uq_olt_power_units_olt_slot')
    )
    op.create_table('olt_shelves',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('olt_id', sa.UUID(), nullable=False),
    sa.Column('shelf_number', sa.Integer(), nullable=False),
    sa.Column('label', sa.String(length=120), nullable=True),
    sa.Column('notes', sa.Text(), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['olt_id'], ['olt_devices.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('olt_id', 'shelf_number', name='uq_olt_shelves_olt_shelf_number')
    )
    op.create_table('on_call_rotation_members',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('rotation_id', sa.UUID(), nullable=False),
    sa.Column('name', sa.String(length=120), nullable=False),
    sa.Column('contact', sa.String(length=255), nullable=False),
    sa.Column('priority', sa.Integer(), nullable=False),
    sa.Column('last_used_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['rotation_id'], ['on_call_rotations.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('people',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('first_name', sa.String(length=80), nullable=False),
    sa.Column('last_name', sa.String(length=80), nullable=False),
    sa.Column('display_name', sa.String(length=120), nullable=True),
    sa.Column('avatar_url', sa.String(length=512), nullable=True),
    sa.Column('bio', sa.Text(), nullable=True),
    sa.Column('email', sa.String(length=255), nullable=False),
    sa.Column('email_verified', sa.Boolean(), nullable=False),
    sa.Column('phone', sa.String(length=40), nullable=True),
    sa.Column('date_of_birth', sa.Date(), nullable=True),
    sa.Column('gender', sa.Enum('unknown', 'female', 'male', 'non_binary', 'other', name='gender'), nullable=False),
    sa.Column('preferred_contact_method', sa.Enum('email', 'phone', 'sms', 'push', name='contactmethod'), nullable=True),
    sa.Column('locale', sa.String(length=16), nullable=True),
    sa.Column('timezone', sa.String(length=64), nullable=True),
    sa.Column('address_line1', sa.String(length=120), nullable=True),
    sa.Column('address_line2', sa.String(length=120), nullable=True),
    sa.Column('city', sa.String(length=80), nullable=True),
    sa.Column('region', sa.String(length=80), nullable=True),
    sa.Column('postal_code', sa.String(length=20), nullable=True),
    sa.Column('country_code', sa.String(length=2), nullable=True),
    sa.Column('party_status', sa.Enum('lead', 'contact', 'customer', 'subscriber', name='partystatus'), nullable=False),
    sa.Column('organization_id', sa.UUID(), nullable=True),
    sa.Column('status', sa.Enum('active', 'inactive', 'archived', name='personstatus'), nullable=False),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('marketing_opt_in', sa.Boolean(), nullable=False),
    sa.Column('notes', sa.Text(), nullable=True),
    sa.Column('metadata', sa.JSON(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['organization_id'], ['organizations.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('email')
    )
    op.create_table('project_template_tasks',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('template_id', sa.UUID(), nullable=False),
    sa.Column('title', sa.String(length=200), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('status', sa.Enum('backlog', 'todo', 'in_progress', 'blocked', 'done', 'canceled', name='project_taskstatus'), nullable=True),
    sa.Column('priority', sa.Enum('low', 'normal', 'high', 'urgent', name='taskpriority'), nullable=True),
    sa.Column('sort_order', sa.Integer(), nullable=False),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['template_id'], ['project_templates.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('provisioning_steps',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('workflow_id', sa.UUID(), nullable=False),
    sa.Column('name', sa.String(length=160), nullable=False),
    sa.Column('step_type', sa.Enum('assign_ont', 'push_config', 'confirm_up', name='provisioningsteptype'), nullable=False),
    sa.Column('order_index', sa.Integer(), nullable=False),
    sa.Column('config', sa.JSON(), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['workflow_id'], ['provisioning_workflows.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('quote_line_items',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('quote_id', sa.UUID(), nullable=False),
    sa.Column('item_type', sa.String(length=80), nullable=True),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('cable_type', sa.String(length=120), nullable=True),
    sa.Column('fiber_count', sa.Integer(), nullable=True),
    sa.Column('splice_count', sa.Integer(), nullable=True),
    sa.Column('quantity', sa.Numeric(precision=12, scale=3), nullable=False),
    sa.Column('unit_price', sa.Numeric(precision=12, scale=2), nullable=False),
    sa.Column('amount', sa.Numeric(precision=12, scale=2), nullable=False),
    sa.Column('notes', sa.Text(), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['quote_id'], ['project_quotes.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('role_permissions',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('role_id', sa.UUID(), nullable=False),
    sa.Column('permission_id', sa.UUID(), nullable=False),
    sa.ForeignKeyConstraint(['permission_id'], ['permissions.id'], ),
    sa.ForeignKeyConstraint(['role_id'], ['roles.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('role_id', 'permission_id', name='uq_role_permissions_role_permission')
    )
    op.create_table('service_qualifications',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('coverage_area_id', sa.UUID(), nullable=True),
    sa.Column('address_id', sa.UUID(), nullable=True),
    sa.Column('latitude', sa.Float(), nullable=False),
    sa.Column('longitude', sa.Float(), nullable=False),
    sa.Column('geom', geoalchemy2.types.Geometry(geometry_type='POINT', srid=4326, from_text='ST_GeomFromEWKT', name='geometry'), nullable=True),
    sa.Column('requested_tech', sa.String(length=60), nullable=True),
    sa.Column('status', sa.Enum('eligible', 'ineligible', 'needs_buildout', name='qualificationstatus'), nullable=False),
    sa.Column('buildout_status', sa.Enum('planned', 'in_progress', 'ready', 'not_planned', name='buildoutstatus'), nullable=True),
    sa.Column('estimated_install_window', sa.String(length=120), nullable=True),
    sa.Column('reasons', sa.JSON(), nullable=True),
    sa.Column('metadata', sa.JSON(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['coverage_area_id'], ['coverage_areas.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    # op.create_index('idx_.*_geom', 'service_qualifications', ['geom'], unique=False, postgresql_using='gist')
    op.create_table('sla_clocks',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('policy_id', sa.UUID(), nullable=False),
    sa.Column('entity_type', sa.Enum('ticket', 'work_order', 'project_task', name='workflowentitytype'), nullable=False),
    sa.Column('entity_id', sa.UUID(), nullable=False),
    sa.Column('priority', sa.String(length=40), nullable=True),
    sa.Column('status', sa.Enum('running', 'paused', 'completed', 'breached', name='slaclockstatus'), nullable=False),
    sa.Column('started_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('paused_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('total_paused_seconds', sa.Integer(), nullable=False),
    sa.Column('due_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('completed_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('breached_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['policy_id'], ['sla_policies.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('sla_targets',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('policy_id', sa.UUID(), nullable=False),
    sa.Column('priority', sa.String(length=40), nullable=True),
    sa.Column('target_minutes', sa.Integer(), nullable=False),
    sa.Column('warning_minutes', sa.Integer(), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['policy_id'], ['sla_policies.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('policy_id', 'priority', name='uq_sla_targets_policy_priority')
    )
    op.create_table('splitters',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('fdh_id', sa.UUID(), nullable=True),
    sa.Column('name', sa.String(length=160), nullable=False),
    sa.Column('splitter_ratio', sa.String(length=40), nullable=True),
    sa.Column('input_ports', sa.Integer(), nullable=False),
    sa.Column('output_ports', sa.Integer(), nullable=False),
    sa.Column('notes', sa.Text(), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['fdh_id'], ['fdh_cabinets.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('fdh_id', 'name', name='uq_splitters_fdh_name')
    )
    op.create_table('webhook_endpoints',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('name', sa.String(length=160), nullable=False),
    sa.Column('url', sa.String(length=500), nullable=False),
    sa.Column('connector_config_id', sa.UUID(), nullable=True),
    sa.Column('secret', sa.String(length=255), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['connector_config_id'], ['connector_configs.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('url', name='uq_webhook_endpoints_url')
    )
    op.create_table('wireguard_peers',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('server_id', sa.UUID(), nullable=False),
    sa.Column('name', sa.String(length=160), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('public_key', sa.String(length=64), nullable=False),
    sa.Column('private_key', sa.Text(), nullable=True),
    sa.Column('preshared_key', sa.Text(), nullable=True),
    sa.Column('allowed_ips', sa.JSON(), nullable=True),
    sa.Column('peer_address', sa.String(length=64), nullable=True),
    sa.Column('peer_address_v6', sa.String(length=64), nullable=True),
    sa.Column('persistent_keepalive', sa.Integer(), nullable=False),
    sa.Column('status', sa.Enum('active', 'disabled', name='wireguardpeerstatus'), nullable=False),
    sa.Column('provision_token_hash', sa.String(length=128), nullable=True),
    sa.Column('provision_token_expires_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('last_handshake_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('endpoint_ip', sa.String(length=64), nullable=True),
    sa.Column('rx_bytes', sa.BigInteger(), nullable=False),
    sa.Column('tx_bytes', sa.BigInteger(), nullable=False),
    sa.Column('metadata', sa.JSON(), nullable=True),
    sa.Column('notes', sa.Text(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['server_id'], ['wireguard_servers.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('alert_notification_logs',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('policy_id', sa.UUID(), nullable=False),
    sa.Column('notification_id', sa.UUID(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['notification_id'], ['notifications.id'], ),
    sa.ForeignKeyConstraint(['policy_id'], ['alert_notification_policies.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('alert_notification_policy_steps',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('policy_id', sa.UUID(), nullable=False),
    sa.Column('step_index', sa.Integer(), nullable=False),
    sa.Column('delay_minutes', sa.Integer(), nullable=False),
    sa.Column('channel', sa.Enum('email', 'sms', 'push', 'whatsapp', 'webhook', name='notificationchannel'), nullable=False),
    sa.Column('recipient', sa.String(length=255), nullable=True),
    sa.Column('template_id', sa.UUID(), nullable=True),
    sa.Column('connector_config_id', sa.UUID(), nullable=True),
    sa.Column('rotation_id', sa.UUID(), nullable=True),
    sa.Column('severity_min', sa.Enum('info', 'warning', 'critical', 'emergency', name='alertseverity'), nullable=False),
    sa.Column('status', sa.Enum('open', 'acknowledged', 'resolved', name='alertstatus'), nullable=False),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['connector_config_id'], ['connector_configs.id'], ),
    sa.ForeignKeyConstraint(['policy_id'], ['alert_notification_policies.id'], ),
    sa.ForeignKeyConstraint(['rotation_id'], ['on_call_rotations.id'], ),
    sa.ForeignKeyConstraint(['template_id'], ['notification_templates.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('api_keys',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('person_id', sa.UUID(), nullable=True),
    sa.Column('label', sa.String(length=120), nullable=True),
    sa.Column('key_hash', sa.String(length=255), nullable=False),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('last_used_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('expires_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('revoked_at', sa.DateTime(timezone=True), nullable=True),
    sa.ForeignKeyConstraint(['person_id'], ['people.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('key_hash')
    )
    op.create_table('buildout_requests',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('qualification_id', sa.UUID(), nullable=True),
    sa.Column('coverage_area_id', sa.UUID(), nullable=True),
    sa.Column('address_id', sa.UUID(), nullable=True),
    sa.Column('requested_by', sa.String(length=120), nullable=True),
    sa.Column('status', sa.Enum('submitted', 'approved', 'rejected', 'canceled', name='buildoutrequeststatus'), nullable=False),
    sa.Column('notes', sa.Text(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['coverage_area_id'], ['coverage_areas.id'], ),
    sa.ForeignKeyConstraint(['qualification_id'], ['service_qualifications.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('cost_rates',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('person_id', sa.UUID(), nullable=True),
    sa.Column('hourly_rate', sa.Numeric(precision=12, scale=2), nullable=False),
    sa.Column('effective_from', sa.DateTime(timezone=True), nullable=True),
    sa.Column('effective_to', sa.DateTime(timezone=True), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['person_id'], ['people.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('crm_agents',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('person_id', sa.UUID(), nullable=False),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('title', sa.String(length=120), nullable=True),
    sa.Column('metadata', sa.JSON(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['person_id'], ['people.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('crm_team_channels',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('team_id', sa.UUID(), nullable=False),
    sa.Column('channel_type', sa.Enum('email', 'whatsapp', 'facebook_messenger', 'instagram_dm', name='channeltype'), nullable=False),
    sa.Column('channel_target_id', sa.UUID(), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['channel_target_id'], ['integration_targets.id'], ),
    sa.ForeignKeyConstraint(['team_id'], ['crm_teams.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('team_id', 'channel_type', 'channel_target_id', name='uq_crm_team_channels_team_type_target')
    )
    op.create_index('uq_crm_team_channels_default', 'crm_team_channels', ['team_id', 'channel_type'], unique=True, sqlite_where=sa.text('channel_target_id IS NULL'), postgresql_where=sa.text('channel_target_id IS NULL'))
    op.create_table('fiber_change_requests',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('asset_type', sa.String(length=80), nullable=False),
    sa.Column('asset_id', sa.UUID(), nullable=True),
    sa.Column('operation', sa.Enum('create', 'update', 'delete', name='fiberchangerequestoperation'), nullable=False),
    sa.Column('payload', sa.JSON(), nullable=False),
    sa.Column('status', sa.Enum('pending', 'applied', 'rejected', name='fiberchangerequeststatus'), nullable=False),
    sa.Column('requested_by_person_id', sa.UUID(), nullable=True),
    sa.Column('requested_by_vendor_id', sa.UUID(), nullable=True),
    sa.Column('reviewed_by_person_id', sa.UUID(), nullable=True),
    sa.Column('review_notes', sa.Text(), nullable=True),
    sa.Column('reviewed_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('applied_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['requested_by_person_id'], ['people.id'], ),
    sa.ForeignKeyConstraint(['requested_by_vendor_id'], ['vendors.id'], ),
    sa.ForeignKeyConstraint(['reviewed_by_person_id'], ['people.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_fiber_change_requests_asset_type', 'fiber_change_requests', ['asset_type'], unique=False)
    op.create_index('ix_fiber_change_requests_status', 'fiber_change_requests', ['status'], unique=False)
    op.create_table('fiber_splices',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('closure_id', sa.UUID(), nullable=False),
    sa.Column('from_strand_id', sa.UUID(), nullable=False),
    sa.Column('to_strand_id', sa.UUID(), nullable=False),
    sa.Column('tray_id', sa.UUID(), nullable=True),
    sa.Column('splice_type', sa.String(length=80), nullable=True),
    sa.Column('loss_db', sa.Float(), nullable=True),
    sa.Column('notes', sa.Text(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['closure_id'], ['fiber_splice_closures.id'], ),
    sa.ForeignKeyConstraint(['from_strand_id'], ['fiber_strands.id'], ),
    sa.ForeignKeyConstraint(['to_strand_id'], ['fiber_strands.id'], ),
    sa.ForeignKeyConstraint(['tray_id'], ['fiber_splice_trays.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('from_strand_id', 'to_strand_id', name='uq_fiber_splices_from_to')
    )
    op.create_table('installation_project_notes',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('project_id', sa.UUID(), nullable=False),
    sa.Column('author_person_id', sa.UUID(), nullable=True),
    sa.Column('body', sa.Text(), nullable=False),
    sa.Column('is_internal', sa.Boolean(), nullable=False),
    sa.Column('attachments', sa.JSON(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['author_person_id'], ['people.id'], ),
    sa.ForeignKeyConstraint(['project_id'], ['installation_projects.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('integration_jobs',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('target_id', sa.UUID(), nullable=False),
    sa.Column('name', sa.String(length=160), nullable=False),
    sa.Column('job_type', sa.Enum('sync', 'export', 'import_', name='integrationjobtype'), nullable=False),
    sa.Column('schedule_type', sa.Enum('manual', 'interval', name='integrationscheduletype'), nullable=False),
    sa.Column('interval_minutes', sa.Integer(), nullable=True),
    sa.Column('interval_seconds', sa.Integer(), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('last_run_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('notes', sa.Text(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['target_id'], ['integration_targets.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('mfa_methods',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('person_id', sa.UUID(), nullable=False),
    sa.Column('method_type', sa.Enum('totp', 'sms', 'email', name='mfamethodtype'), nullable=False),
    sa.Column('label', sa.String(length=120), nullable=True),
    sa.Column('secret', sa.String(length=255), nullable=True),
    sa.Column('phone', sa.String(length=40), nullable=True),
    sa.Column('email', sa.String(length=255), nullable=True),
    sa.Column('is_primary', sa.Boolean(), nullable=False),
    sa.Column('enabled', sa.Boolean(), nullable=False),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('verified_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('last_used_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['person_id'], ['people.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_mfa_methods_primary_per_person', 'mfa_methods', ['person_id'], unique=True, postgresql_where=sa.text('is_primary'), sqlite_where=sa.text('is_primary'))
    op.create_table('notification_deliveries',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('notification_id', sa.UUID(), nullable=False),
    sa.Column('provider', sa.String(length=120), nullable=True),
    sa.Column('provider_message_id', sa.String(length=200), nullable=True),
    sa.Column('status', sa.Enum('accepted', 'delivered', 'failed', 'bounced', 'rejected', name='deliverystatus'), nullable=False),
    sa.Column('response_code', sa.String(length=60), nullable=True),
    sa.Column('response_body', sa.Text(), nullable=True),
    sa.Column('occurred_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.ForeignKeyConstraint(['notification_id'], ['notifications.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('olt_cards',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('shelf_id', sa.UUID(), nullable=False),
    sa.Column('slot_number', sa.Integer(), nullable=False),
    sa.Column('card_type', sa.String(length=120), nullable=True),
    sa.Column('model', sa.String(length=120), nullable=True),
    sa.Column('notes', sa.Text(), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['shelf_id'], ['olt_shelves.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('shelf_id', 'slot_number', name='uq_olt_cards_shelf_slot_number')
    )
    op.create_table('person_channels',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('person_id', sa.UUID(), nullable=False),
    sa.Column('channel_type', sa.Enum('email', 'phone', 'sms', 'whatsapp', 'facebook_messenger', 'instagram_dm', name='channeltype'), nullable=False),
    sa.Column('address', sa.String(length=255), nullable=False),
    sa.Column('label', sa.String(length=60), nullable=True),
    sa.Column('is_primary', sa.Boolean(), nullable=False),
    sa.Column('is_verified', sa.Boolean(), nullable=False),
    sa.Column('verified_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('metadata', sa.JSON(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['person_id'], ['people.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('person_id', 'channel_type', 'address', name='uq_person_channels_person_type_address')
    )
    op.create_table('person_merge_logs',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('source_person_id', sa.UUID(), nullable=False),
    sa.Column('target_person_id', sa.UUID(), nullable=False),
    sa.Column('merged_by_id', sa.UUID(), nullable=True),
    sa.Column('source_snapshot', sa.JSON(), nullable=True),
    sa.Column('merged_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['merged_by_id'], ['people.id'], ),
    sa.ForeignKeyConstraint(['target_person_id'], ['people.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('person_permissions',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('person_id', sa.UUID(), nullable=False),
    sa.Column('permission_id', sa.UUID(), nullable=False),
    sa.Column('granted_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('granted_by_person_id', sa.UUID(), nullable=True),
    sa.ForeignKeyConstraint(['granted_by_person_id'], ['people.id'], ),
    sa.ForeignKeyConstraint(['permission_id'], ['permissions.id'], ),
    sa.ForeignKeyConstraint(['person_id'], ['people.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('person_id', 'permission_id', name='uq_person_permissions_person_permission')
    )
    op.create_table('person_roles',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('person_id', sa.UUID(), nullable=False),
    sa.Column('role_id', sa.UUID(), nullable=False),
    sa.Column('assigned_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['person_id'], ['people.id'], ),
    sa.ForeignKeyConstraint(['role_id'], ['roles.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('person_id', 'role_id', name='uq_person_roles_person_role')
    )
    op.create_table('person_status_logs',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('person_id', sa.UUID(), nullable=False),
    sa.Column('from_status', sa.Enum('lead', 'contact', 'customer', 'subscriber', name='partystatus'), nullable=True),
    sa.Column('to_status', sa.Enum('lead', 'contact', 'customer', 'subscriber', name='partystatus'), nullable=False),
    sa.Column('changed_by_id', sa.UUID(), nullable=True),
    sa.Column('reason', sa.String(length=255), nullable=True),
    sa.Column('metadata', sa.JSON(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['changed_by_id'], ['people.id'], ),
    sa.ForeignKeyConstraint(['person_id'], ['people.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('proposed_route_revisions',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('quote_id', sa.UUID(), nullable=False),
    sa.Column('revision_number', sa.Integer(), nullable=False),
    sa.Column('status', sa.Enum('draft', 'submitted', 'accepted', 'rejected', name='proposedrouterevisionstatus'), nullable=False),
    sa.Column('route_geom', geoalchemy2.types.Geometry(geometry_type='LINESTRING', srid=4326, from_text='ST_GeomFromEWKT', name='geometry'), nullable=True),
    sa.Column('length_meters', sa.Float(), nullable=True),
    sa.Column('submitted_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('submitted_by_person_id', sa.UUID(), nullable=True),
    sa.Column('reviewed_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('reviewed_by_person_id', sa.UUID(), nullable=True),
    sa.Column('review_notes', sa.Text(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['quote_id'], ['project_quotes.id'], ),
    sa.ForeignKeyConstraint(['reviewed_by_person_id'], ['people.id'], ),
    sa.ForeignKeyConstraint(['submitted_by_person_id'], ['people.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('quote_id', 'revision_number', name='uq_proposed_route_quote_revision')
    )
    # op.create_index('idx_.*_geom', 'proposed_route_revisions', ['route_geom'], unique=False, postgresql_using='gist')
    op.create_table('reseller_users',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('reseller_id', sa.UUID(), nullable=False),
    sa.Column('person_id', sa.UUID(), nullable=False),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['person_id'], ['people.id'], ),
    sa.ForeignKeyConstraint(['reseller_id'], ['resellers.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('reseller_id', 'person_id', name='uq_reseller_users_reseller_person')
    )
    op.create_table('sessions',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('person_id', sa.UUID(), nullable=False),
    sa.Column('status', sa.Enum('active', 'revoked', 'expired', name='sessionstatus'), nullable=False),
    sa.Column('token_hash', sa.String(length=255), nullable=False),
    sa.Column('previous_token_hash', sa.String(length=255), nullable=True),
    sa.Column('token_rotated_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('ip_address', sa.String(length=64), nullable=True),
    sa.Column('user_agent', sa.String(length=512), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('last_seen_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('expires_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('revoked_at', sa.DateTime(timezone=True), nullable=True),
    sa.ForeignKeyConstraint(['person_id'], ['people.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ux_sessions_previous_token_hash', 'sessions', ['previous_token_hash'], unique=True)
    op.create_index('ux_sessions_token_hash', 'sessions', ['token_hash'], unique=True)
    op.create_table('sla_breaches',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('clock_id', sa.UUID(), nullable=False),
    sa.Column('status', sa.Enum('open', 'acknowledged', 'resolved', name='slabreachstatus'), nullable=False),
    sa.Column('breached_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('notes', sa.Text(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['clock_id'], ['sla_clocks.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('splitter_ports',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('splitter_id', sa.UUID(), nullable=False),
    sa.Column('port_number', sa.Integer(), nullable=False),
    sa.Column('port_type', sa.Enum('input', 'output', name='splitterporttype'), nullable=False),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('notes', sa.Text(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['splitter_id'], ['splitters.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('splitter_id', 'port_number', name='uq_splitter_ports_splitter_port_number')
    )
    op.create_table('subscribers',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('person_id', sa.UUID(), nullable=True),
    sa.Column('organization_id', sa.UUID(), nullable=True),
    sa.Column('external_id', sa.String(length=120), nullable=True),
    sa.Column('external_system', sa.String(length=60), nullable=True),
    sa.Column('subscriber_number', sa.String(length=60), nullable=True),
    sa.Column('account_number', sa.String(length=60), nullable=True),
    sa.Column('status', sa.Enum('active', 'suspended', 'terminated', 'pending', name='subscriberstatus'), nullable=False),
    sa.Column('service_name', sa.String(length=160), nullable=True),
    sa.Column('service_plan', sa.String(length=120), nullable=True),
    sa.Column('service_speed', sa.String(length=60), nullable=True),
    sa.Column('service_address_line1', sa.String(length=120), nullable=True),
    sa.Column('service_address_line2', sa.String(length=120), nullable=True),
    sa.Column('service_city', sa.String(length=80), nullable=True),
    sa.Column('service_region', sa.String(length=80), nullable=True),
    sa.Column('service_postal_code', sa.String(length=20), nullable=True),
    sa.Column('service_country_code', sa.String(length=2), nullable=True),
    sa.Column('balance', sa.String(length=40), nullable=True),
    sa.Column('currency', sa.String(length=3), nullable=True),
    sa.Column('billing_cycle', sa.String(length=40), nullable=True),
    sa.Column('next_bill_date', sa.DateTime(timezone=True), nullable=True),
    sa.Column('activated_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('suspended_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('terminated_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('last_synced_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('sync_error', sa.String(length=500), nullable=True),
    sa.Column('sync_metadata', sa.JSON(), nullable=True),
    sa.Column('notes', sa.Text(), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['organization_id'], ['organizations.id'], ),
    sa.ForeignKeyConstraint(['person_id'], ['people.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('subscriber_number')
    )
    op.create_index('ix_subscribers_external', 'subscribers', ['external_system', 'external_id'], unique=False)
    op.create_index('ix_subscribers_status', 'subscribers', ['status'], unique=False)
    op.create_table('technician_profiles',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('person_id', sa.UUID(), nullable=False),
    sa.Column('title', sa.String(length=120), nullable=True),
    sa.Column('region', sa.String(length=120), nullable=True),
    sa.Column('metadata', sa.JSON(), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['person_id'], ['people.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('user_credentials',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('person_id', sa.UUID(), nullable=False),
    sa.Column('provider', sa.Enum('local', 'sso', 'radius', name='authprovider'), nullable=False),
    sa.Column('username', sa.String(length=150), nullable=True),
    sa.Column('password_hash', sa.String(length=255), nullable=True),
    sa.Column('must_change_password', sa.Boolean(), nullable=False),
    sa.Column('password_updated_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('failed_login_attempts', sa.Integer(), nullable=False),
    sa.Column('locked_until', sa.DateTime(timezone=True), nullable=True),
    sa.Column('last_login_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.CheckConstraint("(provider != 'local') OR (username IS NOT NULL AND password_hash IS NOT NULL)", name='ck_user_credentials_local_requires_username_password'),
    sa.ForeignKeyConstraint(['person_id'], ['people.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_user_credentials_local_username_unique', 'user_credentials', ['username'], unique=True, postgresql_where=sa.text("provider = 'local'"), sqlite_where=sa.text("provider = 'local'"))
    op.create_table('vendor_users',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('vendor_id', sa.UUID(), nullable=False),
    sa.Column('person_id', sa.UUID(), nullable=False),
    sa.Column('role', sa.String(length=60), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['person_id'], ['people.id'], ),
    sa.ForeignKeyConstraint(['vendor_id'], ['vendors.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('vendor_id', 'person_id', name='uq_vendor_users_vendor_person')
    )
    op.create_table('webhook_subscriptions',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('endpoint_id', sa.UUID(), nullable=False),
    sa.Column('event_type', sa.Enum('subscriber_created', 'subscriber_updated', 'subscriber_suspended', 'subscriber_reactivated', 'subscription_created', 'subscription_activated', 'subscription_suspended', 'subscription_resumed', 'subscription_canceled', 'subscription_upgraded', 'subscription_downgraded', 'subscription_expiring', 'invoice_created', 'invoice_sent', 'invoice_paid', 'invoice_overdue', 'payment_received', 'payment_failed', 'payment_refunded', 'usage_recorded', 'usage_warning', 'usage_exhausted', 'usage_topped_up', 'provisioning_started', 'provisioning_completed', 'provisioning_failed', 'service_order_created', 'service_order_assigned', 'service_order_completed', 'appointment_scheduled', 'appointment_missed', 'device_offline', 'device_online', 'session_started', 'session_ended', 'network_alert', 'ticket_created', 'ticket_escalated', 'ticket_resolved', 'custom', name='webhookeventtype'), nullable=False),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['endpoint_id'], ['webhook_endpoints.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('endpoint_id', 'event_type', name='uq_webhook_subscriptions_endpoint_event')
    )
    op.create_table('wireguard_connection_logs',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('peer_id', sa.UUID(), nullable=False),
    sa.Column('connected_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('disconnected_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('endpoint_ip', sa.String(length=64), nullable=True),
    sa.Column('peer_address', sa.String(length=64), nullable=True),
    sa.Column('rx_bytes', sa.BigInteger(), nullable=False),
    sa.Column('tx_bytes', sa.BigInteger(), nullable=False),
    sa.Column('disconnect_reason', sa.String(length=255), nullable=True),
    sa.ForeignKeyConstraint(['peer_id'], ['wireguard_peers.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('as_built_routes',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('project_id', sa.UUID(), nullable=False),
    sa.Column('proposed_revision_id', sa.UUID(), nullable=True),
    sa.Column('status', sa.Enum('submitted', 'under_review', 'accepted', 'rejected', name='asbuiltroutestatus'), nullable=False),
    sa.Column('route_geom', geoalchemy2.types.Geometry(geometry_type='LINESTRING', srid=4326, from_text='ST_GeomFromEWKT', name='geometry'), nullable=True),
    sa.Column('actual_length_meters', sa.Float(), nullable=True),
    sa.Column('submitted_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('submitted_by_person_id', sa.UUID(), nullable=True),
    sa.Column('reviewed_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('reviewed_by_person_id', sa.UUID(), nullable=True),
    sa.Column('review_notes', sa.Text(), nullable=True),
    sa.Column('fiber_segment_id', sa.UUID(), nullable=True),
    sa.Column('report_file_path', sa.String(length=500), nullable=True),
    sa.Column('report_file_name', sa.String(length=255), nullable=True),
    sa.Column('report_generated_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['fiber_segment_id'], ['fiber_segments.id'], ),
    sa.ForeignKeyConstraint(['project_id'], ['installation_projects.id'], ),
    sa.ForeignKeyConstraint(['proposed_revision_id'], ['proposed_route_revisions.id'], ),
    sa.ForeignKeyConstraint(['reviewed_by_person_id'], ['people.id'], ),
    sa.ForeignKeyConstraint(['submitted_by_person_id'], ['people.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    # op.create_index('idx_.*_geom', 'as_built_routes', ['route_geom'], unique=False, postgresql_using='gist')
    op.create_table('availability_blocks',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('technician_id', sa.UUID(), nullable=False),
    sa.Column('start_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('end_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('reason', sa.String(length=160), nullable=True),
    sa.Column('is_available', sa.Boolean(), nullable=False),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['technician_id'], ['technician_profiles.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('buildout_projects',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('request_id', sa.UUID(), nullable=True),
    sa.Column('coverage_area_id', sa.UUID(), nullable=True),
    sa.Column('address_id', sa.UUID(), nullable=True),
    sa.Column('status', sa.Enum('planned', 'in_progress', 'blocked', 'ready', 'completed', 'canceled', name='buildoutprojectstatus'), nullable=False),
    sa.Column('progress_percent', sa.Integer(), nullable=False),
    sa.Column('target_ready_date', sa.DateTime(timezone=True), nullable=True),
    sa.Column('started_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('completed_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('notes', sa.Text(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['coverage_area_id'], ['coverage_areas.id'], ),
    sa.ForeignKeyConstraint(['request_id'], ['buildout_requests.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('crm_agent_teams',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('agent_id', sa.UUID(), nullable=False),
    sa.Column('team_id', sa.UUID(), nullable=False),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['agent_id'], ['crm_agents.id'], ),
    sa.ForeignKeyConstraint(['team_id'], ['crm_teams.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('agent_id', 'team_id', name='uq_crm_agent_team')
    )
    op.create_table('crm_leads',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('person_id', sa.UUID(), nullable=False),
    sa.Column('pipeline_id', sa.UUID(), nullable=True),
    sa.Column('stage_id', sa.UUID(), nullable=True),
    sa.Column('owner_agent_id', sa.UUID(), nullable=True),
    sa.Column('title', sa.String(length=200), nullable=True),
    sa.Column('status', sa.Enum('new', 'contacted', 'qualified', 'proposal', 'negotiation', 'won', 'lost', name='leadstatus'), nullable=False),
    sa.Column('estimated_value', sa.Numeric(precision=12, scale=2), nullable=True),
    sa.Column('currency', sa.String(length=3), nullable=True),
    sa.Column('notes', sa.Text(), nullable=True),
    sa.Column('metadata', sa.JSON(), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['owner_agent_id'], ['crm_agents.id'], ),
    sa.ForeignKeyConstraint(['person_id'], ['people.id'], ),
    sa.ForeignKeyConstraint(['pipeline_id'], ['crm_pipelines.id'], ),
    sa.ForeignKeyConstraint(['stage_id'], ['crm_pipeline_stages.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('integration_runs',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('job_id', sa.UUID(), nullable=False),
    sa.Column('status', sa.Enum('running', 'success', 'failed', name='integrationrunstatus'), nullable=False),
    sa.Column('started_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('finished_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('error', sa.Text(), nullable=True),
    sa.Column('metrics', sa.JSON(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['job_id'], ['integration_jobs.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('olt_card_ports',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('card_id', sa.UUID(), nullable=False),
    sa.Column('port_number', sa.Integer(), nullable=False),
    sa.Column('name', sa.String(length=120), nullable=True),
    sa.Column('port_type', sa.Enum('pon', 'uplink', 'ethernet', 'mgmt', name='oltporttype'), nullable=False),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('notes', sa.Text(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['card_id'], ['olt_cards.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('card_id', 'port_number', name='uq_olt_card_ports_card_port_number')
    )
    op.create_table('service_orders',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('subscriber_id', sa.UUID(), nullable=True),
    sa.Column('requested_by_contact_id', sa.UUID(), nullable=True),
    sa.Column('status', sa.Enum('draft', 'submitted', 'scheduled', 'provisioning', 'active', 'canceled', 'failed', name='serviceorderstatus'), nullable=False),
    sa.Column('project_type', sa.Enum('cable_rerun', 'fiber_optics_relocation', 'radio_fiber_relocation', 'fiber_optics_installation', 'radio_installation', name='projecttype'), nullable=True),
    sa.Column('notes', sa.Text(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['requested_by_contact_id'], ['people.id'], ),
    sa.ForeignKeyConstraint(['subscriber_id'], ['subscribers.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('shifts',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('technician_id', sa.UUID(), nullable=False),
    sa.Column('start_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('end_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('timezone', sa.String(length=64), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['technician_id'], ['technician_profiles.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('technician_skills',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('technician_id', sa.UUID(), nullable=False),
    sa.Column('skill_id', sa.UUID(), nullable=False),
    sa.Column('proficiency', sa.Integer(), nullable=True),
    sa.Column('is_primary', sa.Boolean(), nullable=False),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['skill_id'], ['skills.id'], ),
    sa.ForeignKeyConstraint(['technician_id'], ['technician_profiles.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('tickets',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('subscriber_id', sa.UUID(), nullable=True),
    sa.Column('created_by_person_id', sa.UUID(), nullable=True),
    sa.Column('assigned_to_person_id', sa.UUID(), nullable=True),
    sa.Column('title', sa.String(length=200), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('status', sa.Enum('new', 'open', 'pending', 'on_hold', 'resolved', 'closed', 'canceled', name='ticketstatus'), nullable=False),
    sa.Column('priority', sa.Enum('low', 'normal', 'high', 'urgent', name='ticketpriority'), nullable=False),
    sa.Column('channel', sa.Enum('web', 'email', 'phone', 'chat', 'api', name='ticketchannel'), nullable=False),
    sa.Column('tags', sa.JSON(), nullable=True),
    sa.Column('metadata', sa.JSON(), nullable=True),
    sa.Column('due_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('resolved_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('closed_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['assigned_to_person_id'], ['people.id'], ),
    sa.ForeignKeyConstraint(['created_by_person_id'], ['people.id'], ),
    sa.ForeignKeyConstraint(['subscriber_id'], ['subscribers.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('webhook_deliveries',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('subscription_id', sa.UUID(), nullable=False),
    sa.Column('endpoint_id', sa.UUID(), nullable=False),
    sa.Column('event_type', sa.Enum('subscriber_created', 'subscriber_updated', 'subscriber_suspended', 'subscriber_reactivated', 'subscription_created', 'subscription_activated', 'subscription_suspended', 'subscription_resumed', 'subscription_canceled', 'subscription_upgraded', 'subscription_downgraded', 'subscription_expiring', 'invoice_created', 'invoice_sent', 'invoice_paid', 'invoice_overdue', 'payment_received', 'payment_failed', 'payment_refunded', 'usage_recorded', 'usage_warning', 'usage_exhausted', 'usage_topped_up', 'provisioning_started', 'provisioning_completed', 'provisioning_failed', 'service_order_created', 'service_order_assigned', 'service_order_completed', 'appointment_scheduled', 'appointment_missed', 'device_offline', 'device_online', 'session_started', 'session_ended', 'network_alert', 'ticket_created', 'ticket_escalated', 'ticket_resolved', 'custom', name='webhookeventtype'), nullable=False),
    sa.Column('status', sa.Enum('pending', 'delivered', 'failed', name='webhookdeliverystatus'), nullable=False),
    sa.Column('attempt_count', sa.Integer(), nullable=False),
    sa.Column('last_attempt_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('delivered_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('response_status', sa.Integer(), nullable=True),
    sa.Column('error', sa.Text(), nullable=True),
    sa.Column('payload', sa.JSON(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['endpoint_id'], ['webhook_endpoints.id'], ),
    sa.ForeignKeyConstraint(['subscription_id'], ['webhook_subscriptions.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('buildout_milestones',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('project_id', sa.UUID(), nullable=False),
    sa.Column('name', sa.String(length=160), nullable=False),
    sa.Column('status', sa.Enum('pending', 'in_progress', 'completed', 'blocked', 'canceled', name='buildoutmilestonestatus'), nullable=False),
    sa.Column('order_index', sa.Integer(), nullable=False),
    sa.Column('due_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('completed_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('notes', sa.Text(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['project_id'], ['buildout_projects.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('buildout_updates',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('project_id', sa.UUID(), nullable=False),
    sa.Column('status', sa.Enum('planned', 'in_progress', 'blocked', 'ready', 'completed', 'canceled', name='buildoutprojectstatus'), nullable=False),
    sa.Column('message', sa.Text(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['project_id'], ['buildout_projects.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('contract_signatures',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('account_id', sa.UUID(), nullable=True),
    sa.Column('service_order_id', sa.UUID(), nullable=True),
    sa.Column('document_id', sa.UUID(), nullable=True),
    sa.Column('signer_name', sa.String(length=200), nullable=False),
    sa.Column('signer_email', sa.String(length=255), nullable=False),
    sa.Column('signed_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('ip_address', sa.String(length=45), nullable=False),
    sa.Column('user_agent', sa.String(length=500), nullable=True),
    sa.Column('agreement_text', sa.Text(), nullable=False),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['document_id'], ['legal_documents.id'], ),
    sa.ForeignKeyConstraint(['service_order_id'], ['service_orders.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('crm_conversations',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('person_id', sa.UUID(), nullable=False),
    sa.Column('ticket_id', sa.UUID(), nullable=True),
    sa.Column('status', sa.Enum('open', 'pending', 'snoozed', 'resolved', name='conversationstatus'), nullable=False),
    sa.Column('subject', sa.String(length=200), nullable=True),
    sa.Column('last_message_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('metadata', sa.JSON(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['person_id'], ['people.id'], ),
    sa.ForeignKeyConstraint(['ticket_id'], ['tickets.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('crm_quotes',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('person_id', sa.UUID(), nullable=False),
    sa.Column('lead_id', sa.UUID(), nullable=True),
    sa.Column('status', sa.Enum('draft', 'sent', 'accepted', 'rejected', 'expired', name='quotestatus'), nullable=False),
    sa.Column('currency', sa.String(length=3), nullable=False),
    sa.Column('subtotal', sa.Numeric(precision=12, scale=2), nullable=False),
    sa.Column('tax_total', sa.Numeric(precision=12, scale=2), nullable=False),
    sa.Column('total', sa.Numeric(precision=12, scale=2), nullable=False),
    sa.Column('expires_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('notes', sa.Text(), nullable=True),
    sa.Column('metadata', sa.JSON(), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['lead_id'], ['crm_leads.id'], ),
    sa.ForeignKeyConstraint(['person_id'], ['people.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('install_appointments',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('service_order_id', sa.UUID(), nullable=False),
    sa.Column('scheduled_start', sa.DateTime(timezone=True), nullable=False),
    sa.Column('scheduled_end', sa.DateTime(timezone=True), nullable=False),
    sa.Column('technician', sa.String(length=120), nullable=True),
    sa.Column('status', sa.Enum('proposed', 'confirmed', 'completed', 'no_show', 'canceled', name='appointmentstatus'), nullable=False),
    sa.Column('notes', sa.Text(), nullable=True),
    sa.Column('is_self_install', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['service_order_id'], ['service_orders.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('olt_sfp_modules',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('olt_card_port_id', sa.UUID(), nullable=False),
    sa.Column('vendor', sa.String(length=120), nullable=True),
    sa.Column('model', sa.String(length=120), nullable=True),
    sa.Column('serial_number', sa.String(length=120), nullable=True),
    sa.Column('wavelength_nm', sa.Integer(), nullable=True),
    sa.Column('rx_power_dbm', sa.Float(), nullable=True),
    sa.Column('tx_power_dbm', sa.Float(), nullable=True),
    sa.Column('installed_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('notes', sa.Text(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['olt_card_port_id'], ['olt_card_ports.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('olt_card_port_id', 'serial_number', name='uq_olt_sfp_modules_port_serial')
    )
    op.create_table('pon_ports',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('olt_id', sa.UUID(), nullable=False),
    sa.Column('olt_card_port_id', sa.UUID(), nullable=True),
    sa.Column('name', sa.String(length=120), nullable=False),
    sa.Column('port_number', sa.Integer(), nullable=True),
    sa.Column('notes', sa.Text(), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['olt_card_port_id'], ['olt_card_ports.id'], ),
    sa.ForeignKeyConstraint(['olt_id'], ['olt_devices.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('olt_id', 'name', name='uq_pon_ports_olt_name')
    )
    op.create_table('projects',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('name', sa.String(length=160), nullable=False),
    sa.Column('code', sa.String(length=80), nullable=True),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('project_type', sa.Enum('cable_rerun', 'fiber_optics_relocation', 'radio_fiber_relocation', 'fiber_optics_installation', 'radio_installation', name='projecttype'), nullable=True),
    sa.Column('project_template_id', sa.UUID(), nullable=True),
    sa.Column('status', sa.Enum('planned', 'active', 'on_hold', 'completed', 'canceled', name='projectstatus'), nullable=False),
    sa.Column('priority', sa.Enum('low', 'normal', 'high', 'urgent', name='projectpriority'), nullable=False),
    sa.Column('subscriber_id', sa.UUID(), nullable=True),
    sa.Column('service_order_id', sa.UUID(), nullable=True),
    sa.Column('created_by_person_id', sa.UUID(), nullable=True),
    sa.Column('owner_person_id', sa.UUID(), nullable=True),
    sa.Column('manager_person_id', sa.UUID(), nullable=True),
    sa.Column('start_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('due_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('completed_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('tags', sa.JSON(), nullable=True),
    sa.Column('metadata', sa.JSON(), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['created_by_person_id'], ['people.id'], ),
    sa.ForeignKeyConstraint(['manager_person_id'], ['people.id'], ),
    sa.ForeignKeyConstraint(['owner_person_id'], ['people.id'], ),
    sa.ForeignKeyConstraint(['project_template_id'], ['project_templates.id'], ),
    sa.ForeignKeyConstraint(['service_order_id'], ['service_orders.id'], ),
    sa.ForeignKeyConstraint(['subscriber_id'], ['subscribers.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('provisioning_runs',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('workflow_id', sa.UUID(), nullable=False),
    sa.Column('service_order_id', sa.UUID(), nullable=True),
    sa.Column('subscription_id', sa.UUID(), nullable=True),
    sa.Column('status', sa.Enum('pending', 'running', 'success', 'failed', name='provisioningrunstatus'), nullable=False),
    sa.Column('started_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('completed_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('input_payload', sa.JSON(), nullable=True),
    sa.Column('output_payload', sa.JSON(), nullable=True),
    sa.Column('error_message', sa.Text(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['service_order_id'], ['service_orders.id'], ),
    sa.ForeignKeyConstraint(['workflow_id'], ['provisioning_workflows.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('provisioning_tasks',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('service_order_id', sa.UUID(), nullable=False),
    sa.Column('name', sa.String(length=160), nullable=False),
    sa.Column('status', sa.Enum('pending', 'in_progress', 'blocked', 'completed', 'failed', name='provisioning_taskstatus'), nullable=False),
    sa.Column('assigned_to', sa.String(length=120), nullable=True),
    sa.Column('started_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('completed_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('notes', sa.Text(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['service_order_id'], ['service_orders.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('service_state_transitions',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('service_order_id', sa.UUID(), nullable=False),
    sa.Column('from_state', sa.Enum('pending', 'installing', 'provisioning', 'active', 'suspended', 'canceled', 'disconnected', name='servicestate'), nullable=True),
    sa.Column('to_state', sa.Enum('pending', 'installing', 'provisioning', 'active', 'suspended', 'canceled', 'disconnected', name='servicestate'), nullable=False),
    sa.Column('reason', sa.String(length=200), nullable=True),
    sa.Column('changed_by', sa.String(length=120), nullable=True),
    sa.Column('changed_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['service_order_id'], ['service_orders.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('ticket_comments',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('ticket_id', sa.UUID(), nullable=False),
    sa.Column('author_person_id', sa.UUID(), nullable=True),
    sa.Column('body', sa.Text(), nullable=False),
    sa.Column('is_internal', sa.Boolean(), nullable=False),
    sa.Column('attachments', sa.JSON(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['author_person_id'], ['people.id'], ),
    sa.ForeignKeyConstraint(['ticket_id'], ['tickets.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('ticket_sla_events',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('ticket_id', sa.UUID(), nullable=False),
    sa.Column('event_type', sa.String(length=60), nullable=False),
    sa.Column('expected_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('actual_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('metadata', sa.JSON(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['ticket_id'], ['tickets.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('crm_conversation_assignments',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('conversation_id', sa.UUID(), nullable=False),
    sa.Column('team_id', sa.UUID(), nullable=True),
    sa.Column('agent_id', sa.UUID(), nullable=True),
    sa.Column('assigned_by_id', sa.UUID(), nullable=True),
    sa.Column('assigned_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.CheckConstraint('team_id IS NOT NULL OR agent_id IS NOT NULL', name='ck_crm_conversation_assignments_team_or_agent'),
    sa.ForeignKeyConstraint(['agent_id'], ['crm_agents.id'], ),
    sa.ForeignKeyConstraint(['assigned_by_id'], ['people.id'], ),
    sa.ForeignKeyConstraint(['conversation_id'], ['crm_conversations.id'], ),
    sa.ForeignKeyConstraint(['team_id'], ['crm_teams.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('conversation_id', 'team_id', 'agent_id', name='uq_crm_conversation_assignments')
    )
    op.create_table('crm_conversation_tags',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('conversation_id', sa.UUID(), nullable=False),
    sa.Column('tag', sa.String(length=80), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['conversation_id'], ['crm_conversations.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('conversation_id', 'tag', name='uq_crm_conversation_tags_conversation_tag')
    )
    op.create_table('crm_messages',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('conversation_id', sa.UUID(), nullable=False),
    sa.Column('person_channel_id', sa.UUID(), nullable=True),
    sa.Column('channel_target_id', sa.UUID(), nullable=True),
    sa.Column('channel_type', sa.Enum('email', 'whatsapp', 'facebook_messenger', 'instagram_dm', name='channeltype'), nullable=False),
    sa.Column('direction', sa.Enum('inbound', 'outbound', name='messagedirection'), nullable=False),
    sa.Column('status', sa.Enum('received', 'queued', 'sent', 'failed', name='messagestatus'), nullable=False),
    sa.Column('subject', sa.String(length=200), nullable=True),
    sa.Column('body', sa.Text(), nullable=True),
    sa.Column('external_id', sa.String(length=120), nullable=True),
    sa.Column('external_ref', sa.String(length=255), nullable=True),
    sa.Column('author_id', sa.UUID(), nullable=True),
    sa.Column('sent_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('received_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('read_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('metadata', sa.JSON(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['author_id'], ['people.id'], ),
    sa.ForeignKeyConstraint(['channel_target_id'], ['integration_targets.id'], ),
    sa.ForeignKeyConstraint(['conversation_id'], ['crm_conversations.id'], ),
    sa.ForeignKeyConstraint(['person_channel_id'], ['person_channels.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('uq_crm_messages_external', 'crm_messages', ['channel_type', sa.text("coalesce(channel_target_id, '00000000-0000-0000-0000-000000000000')"), 'external_id'], unique=True, sqlite_where=sa.text('external_id IS NOT NULL'), postgresql_where=sa.text('external_id IS NOT NULL'))
    op.create_index('uq_crm_messages_inbound_external', 'crm_messages', ['channel_type', 'external_id'], unique=True, sqlite_where=sa.text("external_id IS NOT NULL AND direction = 'inbound' AND channel_type IN ('email', 'facebook_messenger', 'instagram_dm')"), postgresql_where=sa.text("external_id IS NOT NULL AND direction = 'inbound' AND channel_type IN ('email', 'facebook_messenger', 'instagram_dm')"))
    op.create_table('crm_quote_line_items',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('quote_id', sa.UUID(), nullable=False),
    sa.Column('inventory_item_id', sa.UUID(), nullable=True),
    sa.Column('description', sa.String(length=255), nullable=False),
    sa.Column('quantity', sa.Numeric(precision=12, scale=3), nullable=False),
    sa.Column('unit_price', sa.Numeric(precision=12, scale=2), nullable=False),
    sa.Column('amount', sa.Numeric(precision=12, scale=2), nullable=False),
    sa.Column('metadata', sa.JSON(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['inventory_item_id'], ['inventory_items.id'], ),
    sa.ForeignKeyConstraint(['quote_id'], ['crm_quotes.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('ont_assignments',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('ont_unit_id', sa.UUID(), nullable=False),
    sa.Column('pon_port_id', sa.UUID(), nullable=False),
    sa.Column('person_id', sa.UUID(), nullable=True),
    sa.Column('assigned_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('active', sa.Boolean(), nullable=False),
    sa.Column('notes', sa.Text(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['ont_unit_id'], ['ont_units.id'], ),
    sa.ForeignKeyConstraint(['person_id'], ['people.id'], ),
    sa.ForeignKeyConstraint(['pon_port_id'], ['pon_ports.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_ont_assignments_active_unit', 'ont_assignments', ['ont_unit_id'], unique=True, postgresql_where=sa.text('active'))
    op.create_table('pon_port_splitter_links',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('pon_port_id', sa.UUID(), nullable=False),
    sa.Column('splitter_port_id', sa.UUID(), nullable=False),
    sa.Column('active', sa.Boolean(), nullable=False),
    sa.Column('notes', sa.Text(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['pon_port_id'], ['pon_ports.id'], ),
    sa.ForeignKeyConstraint(['splitter_port_id'], ['splitter_ports.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('pon_port_id', name='uq_pon_port_splitter_links_pon_port')
    )
    op.create_table('project_comments',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('project_id', sa.UUID(), nullable=False),
    sa.Column('author_person_id', sa.UUID(), nullable=True),
    sa.Column('body', sa.Text(), nullable=False),
    sa.Column('attachments', sa.JSON(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['author_person_id'], ['people.id'], ),
    sa.ForeignKeyConstraint(['project_id'], ['projects.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('sales_orders',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('quote_id', sa.UUID(), nullable=True),
    sa.Column('person_id', sa.UUID(), nullable=False),
    sa.Column('service_order_id', sa.UUID(), nullable=True),
    sa.Column('order_number', sa.String(length=80), nullable=True),
    sa.Column('status', sa.Enum('draft', 'confirmed', 'paid', 'fulfilled', 'cancelled', name='salesorderstatus'), nullable=False),
    sa.Column('payment_status', sa.Enum('pending', 'partial', 'paid', 'waived', name='salesorderpaymentstatus'), nullable=False),
    sa.Column('currency', sa.String(length=3), nullable=False),
    sa.Column('subtotal', sa.Numeric(precision=12, scale=2), nullable=False),
    sa.Column('tax_total', sa.Numeric(precision=12, scale=2), nullable=False),
    sa.Column('total', sa.Numeric(precision=12, scale=2), nullable=False),
    sa.Column('amount_paid', sa.Numeric(precision=12, scale=2), nullable=False),
    sa.Column('balance_due', sa.Numeric(precision=12, scale=2), nullable=False),
    sa.Column('payment_due_date', sa.DateTime(timezone=True), nullable=True),
    sa.Column('paid_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('deposit_required', sa.Boolean(), nullable=False),
    sa.Column('deposit_paid', sa.Boolean(), nullable=False),
    sa.Column('contract_signed', sa.Boolean(), nullable=False),
    sa.Column('signed_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('notes', sa.Text(), nullable=True),
    sa.Column('metadata', sa.JSON(), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['person_id'], ['people.id'], ),
    sa.ForeignKeyConstraint(['quote_id'], ['crm_quotes.id'], ),
    sa.ForeignKeyConstraint(['service_order_id'], ['service_orders.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('order_number', name='uq_sales_orders_order_number'),
    sa.UniqueConstraint('quote_id', name='uq_sales_orders_quote_id')
    )
    op.create_table('wireless_site_surveys',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('name', sa.String(length=200), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('status', sa.Enum('draft', 'in_progress', 'completed', 'archived', name='surveystatus'), nullable=False),
    sa.Column('min_latitude', sa.Float(), nullable=True),
    sa.Column('min_longitude', sa.Float(), nullable=True),
    sa.Column('max_latitude', sa.Float(), nullable=True),
    sa.Column('max_longitude', sa.Float(), nullable=True),
    sa.Column('frequency_mhz', sa.Float(), nullable=True),
    sa.Column('default_antenna_height_m', sa.Float(), nullable=False),
    sa.Column('default_tx_power_dbm', sa.Float(), nullable=False),
    sa.Column('notes', sa.Text(), nullable=True),
    sa.Column('metadata', sa.JSON(), nullable=True),
    sa.Column('created_by_id', sa.UUID(), nullable=True),
    sa.Column('project_id', sa.UUID(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['created_by_id'], ['people.id'], ),
    sa.ForeignKeyConstraint(['project_id'], ['projects.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('work_orders',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('title', sa.String(length=200), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('status', sa.Enum('draft', 'scheduled', 'dispatched', 'in_progress', 'completed', 'canceled', name='workorderstatus'), nullable=False),
    sa.Column('priority', sa.Enum('low', 'normal', 'high', 'urgent', name='workorderpriority'), nullable=False),
    sa.Column('work_type', sa.Enum('install', 'repair', 'survey', 'maintenance', 'disconnect', 'other', name='workordertype'), nullable=False),
    sa.Column('subscriber_id', sa.UUID(), nullable=True),
    sa.Column('service_order_id', sa.UUID(), nullable=True),
    sa.Column('ticket_id', sa.UUID(), nullable=True),
    sa.Column('project_id', sa.UUID(), nullable=True),
    sa.Column('address_id', sa.UUID(), nullable=True),
    sa.Column('assigned_to_person_id', sa.UUID(), nullable=True),
    sa.Column('scheduled_start', sa.DateTime(timezone=True), nullable=True),
    sa.Column('scheduled_end', sa.DateTime(timezone=True), nullable=True),
    sa.Column('started_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('completed_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('required_skills', sa.JSON(), nullable=True),
    sa.Column('estimated_duration_minutes', sa.Integer(), nullable=True),
    sa.Column('estimated_arrival_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('tags', sa.JSON(), nullable=True),
    sa.Column('metadata', sa.JSON(), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['assigned_to_person_id'], ['people.id'], ),
    sa.ForeignKeyConstraint(['project_id'], ['projects.id'], ),
    sa.ForeignKeyConstraint(['service_order_id'], ['service_orders.id'], ),
    sa.ForeignKeyConstraint(['subscriber_id'], ['subscribers.id'], ),
    sa.ForeignKeyConstraint(['ticket_id'], ['tickets.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('crm_message_attachments',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('message_id', sa.UUID(), nullable=False),
    sa.Column('file_name', sa.String(length=255), nullable=True),
    sa.Column('mime_type', sa.String(length=120), nullable=True),
    sa.Column('file_size', sa.Integer(), nullable=True),
    sa.Column('external_url', sa.String(length=500), nullable=True),
    sa.Column('metadata', sa.JSON(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['message_id'], ['crm_messages.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('eta_updates',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('work_order_id', sa.UUID(), nullable=False),
    sa.Column('eta_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('note', sa.Text(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['work_order_id'], ['work_orders.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('expense_lines',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('work_order_id', sa.UUID(), nullable=True),
    sa.Column('project_id', sa.UUID(), nullable=True),
    sa.Column('amount', sa.Numeric(precision=12, scale=2), nullable=False),
    sa.Column('currency', sa.String(length=3), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['project_id'], ['projects.id'], ),
    sa.ForeignKeyConstraint(['work_order_id'], ['work_orders.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('inventory_reservations',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('item_id', sa.UUID(), nullable=False),
    sa.Column('location_id', sa.UUID(), nullable=False),
    sa.Column('work_order_id', sa.UUID(), nullable=True),
    sa.Column('quantity', sa.Integer(), nullable=False),
    sa.Column('status', sa.Enum('active', 'released', 'consumed', name='reservationstatus'), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['item_id'], ['inventory_items.id'], ),
    sa.ForeignKeyConstraint(['location_id'], ['inventory_locations.id'], ),
    sa.ForeignKeyConstraint(['work_order_id'], ['work_orders.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('project_tasks',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('project_id', sa.UUID(), nullable=False),
    sa.Column('parent_task_id', sa.UUID(), nullable=True),
    sa.Column('title', sa.String(length=200), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('template_task_id', sa.UUID(), nullable=True),
    sa.Column('status', sa.Enum('backlog', 'todo', 'in_progress', 'blocked', 'done', 'canceled', name='project_taskstatus'), nullable=False),
    sa.Column('priority', sa.Enum('low', 'normal', 'high', 'urgent', name='taskpriority'), nullable=False),
    sa.Column('assigned_to_person_id', sa.UUID(), nullable=True),
    sa.Column('created_by_person_id', sa.UUID(), nullable=True),
    sa.Column('ticket_id', sa.UUID(), nullable=True),
    sa.Column('work_order_id', sa.UUID(), nullable=True),
    sa.Column('start_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('due_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('completed_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('effort_hours', sa.Integer(), nullable=True),
    sa.Column('tags', sa.JSON(), nullable=True),
    sa.Column('metadata', sa.JSON(), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['assigned_to_person_id'], ['people.id'], ),
    sa.ForeignKeyConstraint(['created_by_person_id'], ['people.id'], ),
    sa.ForeignKeyConstraint(['parent_task_id'], ['project_tasks.id'], ),
    sa.ForeignKeyConstraint(['project_id'], ['projects.id'], ),
    sa.ForeignKeyConstraint(['template_task_id'], ['project_template_tasks.id'], ),
    sa.ForeignKeyConstraint(['ticket_id'], ['tickets.id'], ),
    sa.ForeignKeyConstraint(['work_order_id'], ['work_orders.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('sales_order_lines',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('sales_order_id', sa.UUID(), nullable=False),
    sa.Column('inventory_item_id', sa.UUID(), nullable=True),
    sa.Column('description', sa.String(length=255), nullable=False),
    sa.Column('quantity', sa.Numeric(precision=12, scale=3), nullable=False),
    sa.Column('unit_price', sa.Numeric(precision=12, scale=2), nullable=False),
    sa.Column('amount', sa.Numeric(precision=12, scale=2), nullable=False),
    sa.Column('metadata', sa.JSON(), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['inventory_item_id'], ['inventory_items.id'], ),
    sa.ForeignKeyConstraint(['sales_order_id'], ['sales_orders.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('survey_points',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('survey_id', sa.UUID(), nullable=False),
    sa.Column('name', sa.String(length=160), nullable=False),
    sa.Column('point_type', sa.Enum('tower', 'access_point', 'cpe', 'repeater', 'custom', name='surveypointtype'), nullable=False),
    sa.Column('latitude', sa.Float(), nullable=False),
    sa.Column('longitude', sa.Float(), nullable=False),
    sa.Column('geom', geoalchemy2.types.Geometry(geometry_type='POINT', srid=4326, from_text='ST_GeomFromEWKT', name='geometry'), nullable=True),
    sa.Column('ground_elevation_m', sa.Float(), nullable=True),
    sa.Column('elevation_source', sa.String(length=50), nullable=True),
    sa.Column('elevation_tile', sa.String(length=20), nullable=True),
    sa.Column('antenna_height_m', sa.Float(), nullable=False),
    sa.Column('antenna_gain_dbi', sa.Float(), nullable=True),
    sa.Column('tx_power_dbm', sa.Float(), nullable=True),
    sa.Column('notes', sa.Text(), nullable=True),
    sa.Column('metadata', sa.JSON(), nullable=True),
    sa.Column('sort_order', sa.Integer(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['survey_id'], ['wireless_site_surveys.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    # op.create_index('idx_.*_geom', 'survey_points', ['geom'], unique=False, postgresql_using='gist')
    op.create_table('survey_responses',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('survey_id', sa.UUID(), nullable=False),
    sa.Column('work_order_id', sa.UUID(), nullable=True),
    sa.Column('ticket_id', sa.UUID(), nullable=True),
    sa.Column('responses', sa.JSON(), nullable=True),
    sa.Column('rating', sa.Integer(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['survey_id'], ['surveys.id'], ),
    sa.ForeignKeyConstraint(['ticket_id'], ['tickets.id'], ),
    sa.ForeignKeyConstraint(['work_order_id'], ['work_orders.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('work_logs',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('work_order_id', sa.UUID(), nullable=False),
    sa.Column('person_id', sa.UUID(), nullable=False),
    sa.Column('start_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('end_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('minutes', sa.Integer(), nullable=False),
    sa.Column('hourly_rate', sa.Numeric(precision=12, scale=2), nullable=True),
    sa.Column('notes', sa.Text(), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['person_id'], ['people.id'], ),
    sa.ForeignKeyConstraint(['work_order_id'], ['work_orders.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('work_order_assignment_queue',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('work_order_id', sa.UUID(), nullable=False),
    sa.Column('status', sa.Enum('queued', 'assigned', 'skipped', name='dispatchqueuestatus'), nullable=False),
    sa.Column('reason', sa.Text(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['work_order_id'], ['work_orders.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('work_order_assignments',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('work_order_id', sa.UUID(), nullable=False),
    sa.Column('person_id', sa.UUID(), nullable=False),
    sa.Column('role', sa.String(length=60), nullable=True),
    sa.Column('assigned_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('is_primary', sa.Boolean(), nullable=False),
    sa.ForeignKeyConstraint(['person_id'], ['people.id'], ),
    sa.ForeignKeyConstraint(['work_order_id'], ['work_orders.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('work_order_notes',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('work_order_id', sa.UUID(), nullable=False),
    sa.Column('author_person_id', sa.UUID(), nullable=True),
    sa.Column('body', sa.Text(), nullable=False),
    sa.Column('is_internal', sa.Boolean(), nullable=False),
    sa.Column('attachments', sa.JSON(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['author_person_id'], ['people.id'], ),
    sa.ForeignKeyConstraint(['work_order_id'], ['work_orders.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('project_task_comments',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('task_id', sa.UUID(), nullable=False),
    sa.Column('author_person_id', sa.UUID(), nullable=True),
    sa.Column('body', sa.Text(), nullable=False),
    sa.Column('attachments', sa.JSON(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['author_person_id'], ['people.id'], ),
    sa.ForeignKeyConstraint(['task_id'], ['project_tasks.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('survey_los_paths',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('survey_id', sa.UUID(), nullable=False),
    sa.Column('from_point_id', sa.UUID(), nullable=False),
    sa.Column('to_point_id', sa.UUID(), nullable=False),
    sa.Column('distance_m', sa.Float(), nullable=True),
    sa.Column('bearing_deg', sa.Float(), nullable=True),
    sa.Column('has_clear_los', sa.Boolean(), nullable=True),
    sa.Column('fresnel_clearance_pct', sa.Float(), nullable=True),
    sa.Column('max_obstruction_m', sa.Float(), nullable=True),
    sa.Column('obstruction_distance_m', sa.Float(), nullable=True),
    sa.Column('elevation_profile', sa.JSON(), nullable=True),
    sa.Column('free_space_loss_db', sa.Float(), nullable=True),
    sa.Column('estimated_rssi_dbm', sa.Float(), nullable=True),
    sa.Column('analysis_timestamp', sa.DateTime(timezone=True), nullable=True),
    sa.Column('sample_count', sa.Integer(), nullable=True),
    sa.Column('notes', sa.Text(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['from_point_id'], ['survey_points.id'], ),
    sa.ForeignKeyConstraint(['survey_id'], ['wireless_site_surveys.id'], ),
    sa.ForeignKeyConstraint(['to_point_id'], ['survey_points.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('work_order_materials',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('work_order_id', sa.UUID(), nullable=False),
    sa.Column('item_id', sa.UUID(), nullable=False),
    sa.Column('reservation_id', sa.UUID(), nullable=True),
    sa.Column('quantity', sa.Integer(), nullable=False),
    sa.Column('status', sa.Enum('required', 'reserved', 'used', name='materialstatus'), nullable=False),
    sa.Column('notes', sa.Text(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['item_id'], ['inventory_items.id'], ),
    sa.ForeignKeyConstraint(['reservation_id'], ['inventory_reservations.id'], ),
    sa.ForeignKeyConstraint(['work_order_id'], ['work_orders.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    # ### end Alembic commands ###


def downgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_table('work_order_materials')
    op.drop_table('survey_los_paths')
    op.drop_table('project_task_comments')
    op.drop_table('work_order_notes')
    op.drop_table('work_order_assignments')
    op.drop_table('work_order_assignment_queue')
    op.drop_table('work_logs')
    op.drop_table('survey_responses')
    op.drop_index('idx_survey_points_geom', table_name='survey_points', postgresql_using='gist')
    op.drop_table('survey_points')
    op.drop_table('sales_order_lines')
    op.drop_table('project_tasks')
    op.drop_table('inventory_reservations')
    op.drop_table('expense_lines')
    op.drop_table('eta_updates')
    op.drop_table('crm_message_attachments')
    op.drop_table('work_orders')
    op.drop_table('wireless_site_surveys')
    op.drop_table('sales_orders')
    op.drop_table('project_comments')
    op.drop_table('pon_port_splitter_links')
    op.drop_index('ix_ont_assignments_active_unit', table_name='ont_assignments', postgresql_where=sa.text('active'))
    op.drop_table('ont_assignments')
    op.drop_table('crm_quote_line_items')
    op.drop_index('uq_crm_messages_inbound_external', table_name='crm_messages', sqlite_where=sa.text("external_id IS NOT NULL AND direction = 'inbound' AND channel_type IN ('email', 'facebook_messenger', 'instagram_dm')"), postgresql_where=sa.text("external_id IS NOT NULL AND direction = 'inbound' AND channel_type IN ('email', 'facebook_messenger', 'instagram_dm')"))
    op.drop_index('uq_crm_messages_external', table_name='crm_messages', sqlite_where=sa.text('external_id IS NOT NULL'), postgresql_where=sa.text('external_id IS NOT NULL'))
    op.drop_table('crm_messages')
    op.drop_table('crm_conversation_tags')
    op.drop_table('crm_conversation_assignments')
    op.drop_table('ticket_sla_events')
    op.drop_table('ticket_comments')
    op.drop_table('service_state_transitions')
    op.drop_table('provisioning_tasks')
    op.drop_table('provisioning_runs')
    op.drop_table('projects')
    op.drop_table('pon_ports')
    op.drop_table('olt_sfp_modules')
    op.drop_table('install_appointments')
    op.drop_table('crm_quotes')
    op.drop_table('crm_conversations')
    op.drop_table('contract_signatures')
    op.drop_table('buildout_updates')
    op.drop_table('buildout_milestones')
    op.drop_table('webhook_deliveries')
    op.drop_table('tickets')
    op.drop_table('technician_skills')
    op.drop_table('shifts')
    op.drop_table('service_orders')
    op.drop_table('olt_card_ports')
    op.drop_table('integration_runs')
    op.drop_table('crm_leads')
    op.drop_table('crm_agent_teams')
    op.drop_table('buildout_projects')
    op.drop_table('availability_blocks')
    op.drop_index('idx_as_built_routes_route_geom', table_name='as_built_routes', postgresql_using='gist')
    op.drop_table('as_built_routes')
    op.drop_table('wireguard_connection_logs')
    op.drop_table('webhook_subscriptions')
    op.drop_table('vendor_users')
    op.drop_index('ix_user_credentials_local_username_unique', table_name='user_credentials', postgresql_where=sa.text("provider = 'local'"), sqlite_where=sa.text("provider = 'local'"))
    op.drop_table('user_credentials')
    op.drop_table('technician_profiles')
    op.drop_index('ix_subscribers_status', table_name='subscribers')
    op.drop_index('ix_subscribers_external', table_name='subscribers')
    op.drop_table('subscribers')
    op.drop_table('splitter_ports')
    op.drop_table('sla_breaches')
    op.drop_index('ux_sessions_token_hash', table_name='sessions')
    op.drop_index('ux_sessions_previous_token_hash', table_name='sessions')
    op.drop_table('sessions')
    op.drop_table('reseller_users')
    op.drop_index('idx_proposed_route_revisions_route_geom', table_name='proposed_route_revisions', postgresql_using='gist')
    op.drop_table('proposed_route_revisions')
    op.drop_table('person_status_logs')
    op.drop_table('person_roles')
    op.drop_table('person_permissions')
    op.drop_table('person_merge_logs')
    op.drop_table('person_channels')
    op.drop_table('olt_cards')
    op.drop_table('notification_deliveries')
    op.drop_index('ix_mfa_methods_primary_per_person', table_name='mfa_methods', postgresql_where=sa.text('is_primary'), sqlite_where=sa.text('is_primary'))
    op.drop_table('mfa_methods')
    op.drop_table('integration_jobs')
    op.drop_table('installation_project_notes')
    op.drop_table('fiber_splices')
    op.drop_index('ix_fiber_change_requests_status', table_name='fiber_change_requests')
    op.drop_index('ix_fiber_change_requests_asset_type', table_name='fiber_change_requests')
    op.drop_table('fiber_change_requests')
    op.drop_index('uq_crm_team_channels_default', table_name='crm_team_channels', sqlite_where=sa.text('channel_target_id IS NULL'), postgresql_where=sa.text('channel_target_id IS NULL'))
    op.drop_table('crm_team_channels')
    op.drop_table('crm_agents')
    op.drop_table('cost_rates')
    op.drop_table('buildout_requests')
    op.drop_table('api_keys')
    op.drop_table('alert_notification_policy_steps')
    op.drop_table('alert_notification_logs')
    op.drop_table('wireguard_peers')
    op.drop_table('webhook_endpoints')
    op.drop_table('splitters')
    op.drop_table('sla_targets')
    op.drop_table('sla_clocks')
    op.drop_index('idx_service_qualifications_geom', table_name='service_qualifications', postgresql_using='gist')
    op.drop_table('service_qualifications')
    op.drop_table('role_permissions')
    op.drop_table('quote_line_items')
    op.drop_table('provisioning_steps')
    op.drop_table('project_template_tasks')
    op.drop_table('people')
    op.drop_table('on_call_rotation_members')
    op.drop_table('olt_shelves')
    op.drop_table('olt_power_units')
    op.drop_index('ix_oauth_tokens_token_expires_at', table_name='oauth_tokens')
    op.drop_index('ix_oauth_tokens_provider', table_name='oauth_tokens')
    op.drop_index('ix_oauth_tokens_connector_config_id', table_name='oauth_tokens')
    op.drop_table('oauth_tokens')
    op.drop_table('notifications')
    op.drop_table('inventory_stock')
    op.drop_table('integration_targets')
    op.drop_table('fiber_splice_trays')
    op.drop_index('idx_fiber_segments_route_geom', table_name='fiber_segments', postgresql_using='gist')
    op.drop_table('fiber_segments')
    op.drop_table('external_references')
    op.drop_table('crm_routing_rules')
    op.drop_table('crm_pipeline_stages')
    op.drop_table('alert_notification_policies')
    op.drop_table('work_order_status_transitions')
    op.drop_index('idx_wireless_masts_geom', table_name='wireless_masts', postgresql_using='gist')
    op.drop_table('wireless_masts')
    op.drop_table('wireguard_servers')
    op.drop_table('vendors')
    op.drop_table('ticket_status_transitions')
    op.drop_table('surveys')
    op.drop_table('sla_policies')
    op.drop_table('skills')
    op.drop_index('idx_service_buildings_geom', table_name='service_buildings', postgresql_using='gist')
    op.drop_index('idx_service_buildings_boundary_geom', table_name='service_buildings', postgresql_using='gist')
    op.drop_table('service_buildings')
    op.drop_table('scheduled_tasks')
    op.drop_table('roles')
    op.drop_table('resellers')
    op.drop_table('queue_mappings')
    op.drop_table('provisioning_workflows')
    op.drop_table('project_templates')
    op.drop_table('project_task_status_transitions')
    op.drop_table('project_quotes')
    op.drop_table('permissions')
    op.drop_table('organizations')
    op.drop_table('ont_units')
    op.drop_table('on_call_rotations')
    op.drop_table('olt_devices')
    op.drop_table('notification_templates')
    op.drop_table('legal_documents')
    op.drop_table('kpi_configs')
    op.drop_table('kpi_aggregates')
    op.drop_table('inventory_locations')
    op.drop_table('inventory_items')
    op.drop_table('installation_projects')
    op.drop_index('idx_geo_locations_geom', table_name='geo_locations', postgresql_using='gist')
    op.drop_table('geo_locations')
    op.drop_table('geo_layers')
    op.drop_index('idx_geo_areas_geom', table_name='geo_areas', postgresql_using='gist')
    op.drop_table('geo_areas')
    op.drop_table('fiber_termination_points')
    op.drop_table('fiber_strands')
    op.drop_index('idx_fiber_splice_closures_geom', table_name='fiber_splice_closures', postgresql_using='gist')
    op.drop_table('fiber_splice_closures')
    op.drop_index('idx_fiber_access_points_geom', table_name='fiber_access_points', postgresql_using='gist')
    op.drop_table('fiber_access_points')
    op.drop_index('idx_fdh_cabinets_geom', table_name='fdh_cabinets', postgresql_using='gist')
    op.drop_table('fdh_cabinets')
    op.drop_index(op.f('ix_event_store_subscriber_id'), table_name='event_store')
    op.drop_index(op.f('ix_event_store_status'), table_name='event_store')
    op.drop_index(op.f('ix_event_store_event_type'), table_name='event_store')
    op.drop_index(op.f('ix_event_store_event_id'), table_name='event_store')
    op.drop_index(op.f('ix_event_store_account_id'), table_name='event_store')
    op.drop_table('event_store')
    op.drop_table('domain_settings')
    op.drop_table('document_sequences')
    op.drop_table('dispatch_rules')
    op.drop_table('customer_notification_events')
    op.drop_table('crm_teams')
    op.drop_table('crm_social_comments')
    op.drop_table('crm_social_comment_replies')
    op.drop_table('crm_pipelines')
    op.drop_index('idx_coverage_areas_geom', table_name='coverage_areas', postgresql_using='gist')
    op.drop_table('coverage_areas')
    op.drop_table('connector_configs')
    op.drop_table('billing_rates')
    op.drop_table('bandwidth_samples')
    op.drop_table('audit_events')
    # ### end Alembic commands ###

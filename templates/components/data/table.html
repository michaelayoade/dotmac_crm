{#
   Data Table Component
   Usage: {% include "components/data/table.html" %}

   Parameters:
   - columns: List of {key, label, sortable, class} dicts
   - htmx_url: URL for HTMX requests
   - htmx_target: Target element ID for HTMX swaps
   - create_url: URL for create button
   - create_label: Label for create button
   - search_placeholder: Search input placeholder
   - search_value: Current search value (optional)
   - current_order_by: Current sort column
   - current_order_dir: Current sort direction (asc/desc)
   - table_density: compact | comfortable | spacious
   - bulk_actions: HTML for bulk actions (optional)
   - filters: HTML for filter controls (optional)
#}
{% from "components/ui/macros.html" import table_shell %}
{% set target_id = htmx_target | default('table-body') %}
{% set density = table_density | default('comfortable') %}
{% call table_shell(
    table_id=target_id,
    search=True,
    search_name="search",
    search_value=search_value | default(''),
    search_placeholder=search_placeholder | default('Search...'),
    search_hx_url=htmx_url,
    search_hx_target="#" ~ target_id,
    search_hx_include="[name='order_by'],[name='order_dir']",
    filters=filters | default(None),
    bulk_actions=bulk_actions | default(None),
    density=density
) %}
    <!-- Hidden inputs for sorting -->
    <input type="hidden" name="order_by" value="{{ current_order_by | default('created_at') }}" />
    <input type="hidden" name="order_dir" value="{{ current_order_dir | default('desc') }}" />

    <table class="min-w-full divide-y divide-slate-200 dark:divide-slate-700">
        <thead class="bg-slate-50 dark:bg-slate-900/50">
            <tr>
                {% for col in columns %}
                <th scope="col"
                    class="{% if density == 'compact' %}px-4 py-2{% elif density == 'spacious' %}px-6 py-4{% else %}px-6 py-3{% endif %} text-left text-xs font-semibold uppercase tracking-wider text-slate-500 dark:text-slate-400 {{ col.class | default('') }}">
                    {% if col.sortable and htmx_url %}
                    <button hx-get="{{ htmx_url }}?order_by={{ col.key }}&order_dir={{ 'desc' if current_order_by == col.key and current_order_dir == 'asc' else 'asc' }}"
                            hx-target="#{{ target_id }}"
                            hx-include="[name='search']"
                            class="flex items-center gap-1 hover:text-slate-700 dark:hover:text-slate-200">
                        {{ col.label }}
                        {% if current_order_by == col.key %}
                        <svg class="h-4 w-4 {{ 'rotate-180' if current_order_dir == 'asc' else '' }}" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                        </svg>
                        {% else %}
                        <svg class="h-4 w-4 opacity-0 group-hover:opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"/>
                        </svg>
                        {% endif %}
                    </button>
                    {% else %}
                    {{ col.label }}
                    {% endif %}
                </th>
                {% endfor %}
            </tr>
        </thead>
        <tbody id="{{ target_id }}"
               class="divide-y divide-slate-200 bg-white dark:divide-slate-700 dark:bg-slate-800">
            {% block table_body %}{% endblock %}
        </tbody>
    </table>

    <!-- Pagination -->
    {% block table_pagination %}{% endblock %}
{% endcall %}

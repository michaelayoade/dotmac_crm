{% from "components/ui/macros.html" import danger_button, submit_button %}
{% if steps %}
<div class="space-y-3">
    {% for step in steps %}
    <div class="rounded-lg border border-slate-200 bg-slate-50 p-4 dark:border-slate-700 dark:bg-slate-700/30">
        <div class="flex items-start justify-between">
            <div>
                <div class="flex items-center gap-2">
                    <span class="inline-flex items-center justify-center rounded-full bg-primary-100 px-2 py-0.5 text-xs font-semibold text-primary-700 dark:bg-primary-600/20 dark:text-primary-400">Step {{ step.step_index + 1 }}</span>
                    <span class="text-sm font-medium text-slate-900 dark:text-white">{{ step.name or 'Untitled Step' }}</span>
                </div>
                <p class="mt-1 text-sm text-slate-500 dark:text-slate-400">
                    Delay: {{ step.delay_days }} day{{ 's' if step.delay_days != 1 }}
                    {% if step.subject %} | Subject: {{ step.subject|truncate(50) }}{% endif %}
                </p>
            </div>
            {% if campaign.status.value == 'draft' %}
            {{ danger_button("Delete", "Confirm Delete", "Delete this step?", "/admin/crm/campaigns/" ~ campaign.id ~ "/steps/" ~ step.id ~ "/delete", size="sm") }}
            {% endif %}
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<p class="text-sm text-slate-500 dark:text-slate-400">No nurture steps defined.</p>
{% endif %}

{% if campaign.status.value == 'draft' %}
<form method="post" action="/admin/crm/campaigns/{{ campaign.id }}/steps"
      class="mt-4 rounded-lg border border-dashed border-slate-300 bg-white p-4 dark:border-slate-600 dark:bg-slate-800">
    <h3 class="text-sm font-semibold text-slate-700 dark:text-slate-300 mb-3">Add Step</h3>
    <div class="grid grid-cols-1 gap-3 sm:grid-cols-3">
        <div>
            <label class="block text-xs font-semibold text-slate-500 dark:text-slate-400 mb-1">Name</label>
            <input type="text" name="name" placeholder="Follow-up email"
                   class="block w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm focus:border-primary-500 focus:outline-none focus:ring-1 focus:ring-primary-500 dark:border-slate-600 dark:bg-slate-700 dark:text-white">
        </div>
        <div>
            <label class="block text-xs font-semibold text-slate-500 dark:text-slate-400 mb-1">Delay (days)</label>
            <input type="number" name="delay_days" value="3" min="0"
                   class="block w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm focus:border-primary-500 focus:outline-none focus:ring-1 focus:ring-primary-500 dark:border-slate-600 dark:bg-slate-700 dark:text-white">
        </div>
        <div>
            <label class="block text-xs font-semibold text-slate-500 dark:text-slate-400 mb-1">Step Index</label>
            <input type="number" name="step_index" value="{{ steps|length }}" min="0"
                   class="block w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm focus:border-primary-500 focus:outline-none focus:ring-1 focus:ring-primary-500 dark:border-slate-600 dark:bg-slate-700 dark:text-white">
        </div>
    </div>
    <div class="mt-3">
        <label class="block text-xs font-semibold text-slate-500 dark:text-slate-400 mb-1">Subject</label>
        <input type="text" name="subject" placeholder="Subject for this step"
               class="block w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm focus:border-primary-500 focus:outline-none focus:ring-1 focus:ring-primary-500 dark:border-slate-600 dark:bg-slate-700 dark:text-white">
    </div>
    <div class="mt-3">
        <label class="block text-xs font-semibold text-slate-500 dark:text-slate-400 mb-1">Body HTML</label>
        <textarea name="body_html" rows="4"
                  class="block w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm font-mono focus:border-primary-500 focus:outline-none focus:ring-1 focus:ring-primary-500 dark:border-slate-600 dark:bg-slate-700 dark:text-white"></textarea>
    </div>
    <div class="mt-3 flex justify-end">
        {{ submit_button("Add Step", loading_label="Adding...") }}
    </div>
</form>
{% endif %}

{% if recipients %}
<div class="overflow-x-auto">
    <table class="min-w-full divide-y divide-slate-200 dark:divide-slate-700">
        <thead>
            <tr class="bg-slate-50 dark:bg-slate-700/50">
                <th class="px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider text-slate-500 dark:text-slate-300">Recipient</th>
                <th class="px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider text-slate-500 dark:text-slate-300">Email</th>
                <th class="px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider text-slate-500 dark:text-slate-300">Status</th>
                <th class="px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider text-slate-500 dark:text-slate-300">Sent At</th>
            </tr>
        </thead>
        <tbody class="divide-y divide-slate-100 dark:divide-slate-700/50">
            {% for r in recipients %}
            {% set person = person_map.get(r.person_id|string) %}
            <tr class="hover:bg-slate-50 dark:hover:bg-slate-700/40">
                <td class="px-6 py-3 text-sm text-slate-900 dark:text-white">
                    {% if person %}
                    {{ person.display_name or (person.first_name ~ ' ' ~ person.last_name)|trim or 'Unknown' }}
                    {% else %}
                    Unknown
                    {% endif %}
                </td>
                <td class="px-6 py-3 text-sm text-slate-600 dark:text-slate-300">{{ r.email }}</td>
                <td class="px-6 py-3">
                    {% set rs_colors = {
                        'pending': 'bg-slate-100 text-slate-600 dark:bg-slate-700 dark:text-slate-300',
                        'sent': 'bg-blue-100 text-blue-700 dark:bg-blue-500/20 dark:text-blue-400',
                        'delivered': 'bg-green-100 text-green-700 dark:bg-green-500/20 dark:text-green-400',
                        'failed': 'bg-red-100 text-red-700 dark:bg-red-500/20 dark:text-red-400',
                        'bounced': 'bg-orange-100 text-orange-700 dark:bg-orange-500/20 dark:text-orange-400',
                        'unsubscribed': 'bg-yellow-100 text-yellow-700 dark:bg-yellow-500/20 dark:text-yellow-400',
                    } %}
                    <span class="inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-semibold {{ rs_colors.get(r.status.value, 'bg-slate-100 text-slate-600') }}">
                        {{ r.status.value|capitalize }}
                    </span>
                    {% if r.failed_reason %}
                    <span class="ml-1 text-xs text-red-500" title="{{ r.failed_reason }}">!</span>
                    {% endif %}
                </td>
                <td class="px-6 py-3 text-sm text-slate-500 dark:text-slate-400">
                    {{ r.sent_at.strftime('%Y-%m-%d %H:%M') if r.sent_at else 'â€”' }}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<p class="px-6 py-8 text-center text-sm text-slate-500 dark:text-slate-400">No recipients yet. Send the campaign to populate this list.</p>
{% endif %}

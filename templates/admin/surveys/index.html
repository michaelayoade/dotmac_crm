{% extends "layouts/admin.html" %}

{% block title %}Surveys - Admin{% endblock %}

{% block content %}
<div class="space-y-6">
    <!-- Header -->
    <div class="flex items-center justify-between">
        <div>
            <h1 class="text-2xl font-bold text-slate-900 dark:text-white">Surveys</h1>
            <p class="mt-1 text-sm text-slate-500 dark:text-slate-400">Collect customer feedback with rating, NPS, and custom questions</p>
        </div>
        <a href="/admin/surveys/new" class="inline-flex items-center gap-2 rounded-lg bg-teal-600 px-4 py-2.5 text-sm font-medium text-white shadow-sm hover:bg-teal-700 transition-colors">
            <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg>
            New Survey
        </a>
    </div>

    <!-- Status Filter Tabs -->
    <div class="flex flex-wrap gap-2 border-b border-slate-200 dark:border-slate-700 pb-4">
        <a href="/admin/surveys"
           class="rounded-lg px-3 py-1.5 text-sm font-medium transition-colors {{ 'bg-teal-100 text-teal-700 dark:bg-teal-600/20 dark:text-teal-400' if not filter_status else 'text-slate-500 hover:bg-slate-100 hover:text-slate-700 dark:text-slate-400 dark:hover:bg-slate-800' }}">
            All {% if status_counts %}({{ status_counts.values() | sum }}){% endif %}
        </a>
        {% for st in ['draft', 'active', 'paused', 'closed'] %}
        <a href="/admin/surveys?status={{ st }}"
           class="rounded-lg px-3 py-1.5 text-sm font-medium transition-colors {{ 'bg-teal-100 text-teal-700 dark:bg-teal-600/20 dark:text-teal-400' if filter_status == st else 'text-slate-500 hover:bg-slate-100 hover:text-slate-700 dark:text-slate-400 dark:hover:bg-slate-800' }}">
            {{ st | capitalize }} {% if status_counts.get(st) %}({{ status_counts[st] }}){% endif %}
        </a>
        {% endfor %}
    </div>

    <!-- Search -->
    <form method="GET" action="/admin/surveys" class="flex gap-2">
        {% if filter_status %}<input type="hidden" name="status" value="{{ filter_status }}">{% endif %}
        <input type="text" name="search" value="{{ search }}" placeholder="Search surveys..."
               class="flex-1 rounded-lg border border-slate-200 px-4 py-2 text-sm text-slate-700 placeholder-slate-400 focus:border-teal-500 focus:ring-1 focus:ring-teal-500 dark:border-slate-600 dark:bg-slate-800 dark:text-slate-200 dark:placeholder-slate-500">
        <button type="submit" class="rounded-lg bg-slate-100 px-4 py-2 text-sm font-medium text-slate-700 hover:bg-slate-200 dark:bg-slate-700 dark:text-slate-300 dark:hover:bg-slate-600">Search</button>
    </form>

    <!-- Survey List -->
    {% if surveys %}
    <div class="overflow-hidden rounded-xl border border-slate-200 bg-white shadow-sm dark:border-slate-700 dark:bg-slate-800">
        <table class="min-w-full divide-y divide-slate-200 dark:divide-slate-700">
            <thead class="bg-slate-50 dark:bg-slate-800/50">
                <tr>
                    <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-slate-500 dark:text-slate-400">Name</th>
                    <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-slate-500 dark:text-slate-400">Status</th>
                    <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-slate-500 dark:text-slate-400">Trigger</th>
                    <th class="px-6 py-3 text-center text-xs font-medium uppercase tracking-wider text-slate-500 dark:text-slate-400">Responses</th>
                    <th class="px-6 py-3 text-center text-xs font-medium uppercase tracking-wider text-slate-500 dark:text-slate-400">Avg Rating</th>
                    <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-slate-500 dark:text-slate-400">Created</th>
                </tr>
            </thead>
            <tbody class="divide-y divide-slate-200 dark:divide-slate-700">
                {% for survey in surveys %}
                <tr class="hover:bg-slate-50 dark:hover:bg-slate-700/50 cursor-pointer" onclick="window.location='/admin/surveys/{{ survey.id }}'">
                    <td class="px-6 py-4">
                        <div class="text-sm font-medium text-slate-900 dark:text-white">{{ survey.name }}</div>
                        {% if survey.description %}
                        <div class="text-xs text-slate-500 dark:text-slate-400 truncate max-w-xs">{{ survey.description }}</div>
                        {% endif %}
                    </td>
                    <td class="px-6 py-4">
                        {% set status_colors = {'draft': 'bg-slate-100 text-slate-700 dark:bg-slate-600/30 dark:text-slate-300', 'active': 'bg-green-100 text-green-700 dark:bg-green-600/20 dark:text-green-400', 'paused': 'bg-amber-100 text-amber-700 dark:bg-amber-600/20 dark:text-amber-400', 'closed': 'bg-red-100 text-red-700 dark:bg-red-600/20 dark:text-red-400'} %}
                        <span class="inline-flex rounded-full px-2 py-0.5 text-xs font-medium {{ status_colors.get(survey.status.value, 'bg-slate-100 text-slate-700') }}">
                            {{ survey.status.value | capitalize }}
                        </span>
                    </td>
                    <td class="px-6 py-4 text-sm text-slate-500 dark:text-slate-400">
                        {{ survey.trigger_type.value | replace('_', ' ') | title }}
                    </td>
                    <td class="px-6 py-4 text-center text-sm text-slate-700 dark:text-slate-300">
                        {{ survey.total_responses }}{% if survey.total_invited %}/{{ survey.total_invited }}{% endif %}
                    </td>
                    <td class="px-6 py-4 text-center text-sm text-slate-700 dark:text-slate-300">
                        {% if survey.avg_rating %}{{ "%.1f" | format(survey.avg_rating) }}{% else %}-{% endif %}
                    </td>
                    <td class="px-6 py-4 text-sm text-slate-500 dark:text-slate-400">
                        {{ survey.created_at.strftime('%b %d, %Y') }}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="rounded-xl border-2 border-dashed border-slate-200 bg-white p-12 text-center dark:border-slate-700 dark:bg-slate-800">
        <svg class="mx-auto h-12 w-12 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
        </svg>
        <h3 class="mt-4 text-lg font-medium text-slate-900 dark:text-white">No surveys yet</h3>
        <p class="mt-2 text-sm text-slate-500 dark:text-slate-400">Create your first survey to start collecting customer feedback.</p>
        <a href="/admin/surveys/new" class="mt-4 inline-flex items-center gap-2 rounded-lg bg-teal-600 px-4 py-2 text-sm font-medium text-white hover:bg-teal-700">
            <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg>
            New Survey
        </a>
    </div>
    {% endif %}
</div>
{% endblock %}

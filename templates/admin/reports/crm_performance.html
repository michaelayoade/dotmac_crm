{% extends "layouts/admin.html" %}

{% block title %}CRM Performance Report - Admin{% endblock %}

{% block charts_js %}
<script src="/static/js/vendor/chart.min.js"></script>
<script src="/static/js/charts.js"></script>
{% endblock %}

{% block content %}
<div class="space-y-6">
    <div class="flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between">
        <div>
            <h1 class="text-2xl font-bold text-slate-900 dark:text-white">CRM Performance</h1>
            <p class="mt-1 text-sm text-slate-500 dark:text-slate-400">Agent and team conversation metrics</p>
        </div>
        <form method="GET" action="/admin/reports/crm-performance" class="flex flex-wrap items-center gap-2">
            <select name="days" class="rounded-lg border border-slate-300 px-3 py-2 text-sm dark:border-slate-600 dark:bg-slate-700 dark:text-white">
                <option value="7" {% if days == 7 %}selected{% endif %}>Last 7 Days</option>
                <option value="30" {% if days == 30 %}selected{% endif %}>Last 30 Days</option>
                <option value="60" {% if days == 60 %}selected{% endif %}>Last 60 Days</option>
                <option value="90" {% if days == 90 %}selected{% endif %}>Last 90 Days</option>
            </select>
            <select name="team_id" class="rounded-lg border border-slate-300 px-3 py-2 text-sm dark:border-slate-600 dark:bg-slate-700 dark:text-white">
                <option value="">All Teams</option>
                {% for team in teams %}
                <option value="{{ team.id }}" {% if selected_team_id == team.id | string %}selected{% endif %}>{{ team.name }}</option>
                {% endfor %}
            </select>
            <select name="agent_id" class="rounded-lg border border-slate-300 px-3 py-2 text-sm dark:border-slate-600 dark:bg-slate-700 dark:text-white">
                <option value="">All Agents</option>
                {% for agent in agents %}
                <option value="{{ agent.id }}" {% if selected_agent_id == agent.id | string %}selected{% endif %}>{{ agent_labels.get(agent.id | string, 'Agent') }}</option>
                {% endfor %}
            </select>
            <select name="channel_type" class="rounded-lg border border-slate-300 px-3 py-2 text-sm dark:border-slate-600 dark:bg-slate-700 dark:text-white">
                <option value="">All Channels</option>
                {% for ct in channel_types %}
                <option value="{{ ct }}" {% if selected_channel_type == ct %}selected{% endif %}>{{ ct | replace('_', ' ') | title }}</option>
                {% endfor %}
            </select>
            <button type="submit" class="inline-flex items-center gap-2 rounded-lg bg-primary-600 px-4 py-2 text-sm font-medium text-white hover:bg-primary-700">
                <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"/></svg>
                Filter
            </button>
            <a href="/admin/reports/crm-performance/export?days={{ days }}{% if selected_agent_id %}&agent_id={{ selected_agent_id }}{% endif %}{% if selected_team_id %}&team_id={{ selected_team_id }}{% endif %}{% if selected_channel_type %}&channel_type={{ selected_channel_type }}{% endif %}" class="inline-flex items-center gap-2 rounded-lg border border-slate-300 bg-white px-4 py-2 text-sm font-medium text-slate-700 hover:bg-slate-50 dark:border-slate-600 dark:bg-slate-800 dark:text-slate-300">
                <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/></svg>
                Export CSV
            </a>
        </form>
    </div>

    {% include "shared/reports/_crm_performance_body.html" %}
</div>
{% endblock %}

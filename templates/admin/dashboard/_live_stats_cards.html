{% set m = high_priority_stats | default({}) %}
<div id="dashboard-live-stats-cards"
     class="grid grid-cols-1 gap-4 sm:grid-cols-2 animate-fade-in-up"
     style="animation-delay: 0.15s"
     hx-get="/admin/dashboard/live-stats"
     hx-trigger="every 30s"
     hx-swap="outerHTML">
    <div class="rounded-2xl border border-slate-200/60 bg-white p-4 shadow-sm dark:border-slate-700/60 dark:bg-slate-800 {% if (m.failed_outbox_count | default(0)) > 0 %}card-alert-pulse border-rose-300/80 dark:border-rose-500/40{% endif %}">
        <div class="flex items-center justify-between">
            <p class="text-xs font-semibold uppercase tracking-wide text-slate-500 dark:text-slate-400">Failed Outbox</p>
            {% if (m.failed_outbox_count | default(0)) > 0 %}
            <span class="inline-flex items-center rounded-full bg-rose-100 px-2 py-0.5 text-[11px] font-semibold text-rose-700 dark:bg-rose-900/30 dark:text-rose-300">Errors</span>
            {% endif %}
        </div>
        <p class="mt-2 text-3xl font-bold {% if (m.failed_outbox_count | default(0)) > 0 %}text-rose-600 dark:text-rose-400{% else %}text-slate-900 dark:text-white{% endif %}">
            {{ m.failed_outbox_count | default(0) }}
        </p>
        <a href="/admin/crm/inbox?outbox_status=failed"
           class="mt-2 inline-flex items-center gap-1 text-xs font-medium text-cyan-600 hover:text-cyan-700 dark:text-cyan-400">
            Open failed outbox
        </a>
    </div>

    <div class="rounded-2xl border border-slate-200/60 bg-white p-4 shadow-sm dark:border-slate-700/60 dark:bg-slate-800">
        <div class="flex items-center justify-between">
            <p class="text-xs font-semibold uppercase tracking-wide text-slate-500 dark:text-slate-400">Waiting Queue</p>
            <span class="inline-flex items-center rounded-full bg-amber-100 px-2 py-0.5 text-[11px] font-semibold text-amber-700 dark:bg-amber-900/30 dark:text-amber-300">Needs Action</span>
        </div>
        <p class="mt-2 text-3xl font-bold text-slate-900 dark:text-white">{{ m.waiting_queue_count | default(0) }}</p>
        <a href="/admin/crm/inbox?status=needs_action"
           hx-get="/admin/crm/inbox?status=needs_action"
           hx-target="body"
           hx-swap="outerHTML"
           hx-push-url="true"
           class="mt-2 inline-flex items-center gap-1 text-xs font-medium text-cyan-600 hover:text-cyan-700 dark:text-cyan-400">
            Open needs-action queue
        </a>
    </div>
</div>

<style>
.card-alert-pulse {
    animation: cardAlertPulse 1.6s ease-in-out infinite;
}

@keyframes cardAlertPulse {
    0%, 100% { box-shadow: 0 0 0 0 rgba(244, 63, 94, 0.0); }
    50% { box-shadow: 0 0 0 6px rgba(244, 63, 94, 0.16); }
}

@media (prefers-reduced-motion: reduce) {
    .card-alert-pulse {
        animation: none;
    }
}
</style>

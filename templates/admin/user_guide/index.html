{% extends "layouts/admin.html" %}
{% from "components/ui/macros.html" import page_header %}

{% block title %}User Guide - Admin{% endblock %}

{% block content %}
<div class="space-y-6">
    {% call page_header("User Guide", "Module-by-module guides for day-to-day CRM operations", color="sky", color2="cyan", icon='<svg class="h-6 w-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.483 9.246 5 7.5 5S4.168 5.483 3 6.253v13C4.168 18.483 5.754 18 7.5 18s3.332.483 4.5 1.253m0-13C13.168 5.483 14.754 5 16.5 5s3.332.483 4.5 1.253v13C19.832 18.483 18.246 18 16.5 18s-3.332.483-4.5 1.253"/></svg>') %}
    {% endcall %}

    <div class="grid grid-cols-1 gap-6 xl:grid-cols-12">
        <aside class="xl:col-span-4">
            <div class="rounded-2xl border border-slate-200/60 bg-white p-4 shadow-sm dark:border-slate-700/60 dark:bg-slate-800">
                <h2 class="mb-3 text-xs font-semibold uppercase tracking-wider text-slate-400 dark:text-slate-500">Guide Modules</h2>
                <nav class="space-y-1.5">
                    {% for item in modules %}
                    <a href="{{ item.href }}"
                       class="block rounded-lg border px-3 py-2.5 text-sm transition-colors {{ 'border-sky-200 bg-sky-50 text-sky-700 dark:border-sky-700/50 dark:bg-sky-900/20 dark:text-sky-300' if selected_module.key == item.key else 'border-transparent text-slate-600 hover:border-slate-200 hover:bg-slate-50 hover:text-slate-900 dark:text-slate-300 dark:hover:border-slate-700 dark:hover:bg-slate-900/40 dark:hover:text-white' }}">
                        <p class="font-medium">{{ item.title }}</p>
                        <p class="mt-0.5 text-xs text-slate-500 dark:text-slate-400">{{ item.summary }}</p>
                    </a>
                    {% endfor %}
                </nav>
            </div>
        </aside>

        <section class="xl:col-span-8">
            <div class="rounded-2xl border border-slate-200/60 bg-white p-6 shadow-sm dark:border-slate-700/60 dark:bg-slate-800">
                <p class="text-xs font-semibold uppercase tracking-wider text-slate-400 dark:text-slate-500">Selected Module</p>
                <h2 class="mt-2 text-2xl font-semibold text-slate-900 dark:text-white">{{ selected_module.title }}</h2>
                <p class="mt-2 text-sm text-slate-600 dark:text-slate-300">{{ selected_module.summary }}</p>

                <div class="mt-6 grid grid-cols-1 gap-4 md:grid-cols-2">
                    <div class="rounded-xl border border-slate-200/70 bg-slate-50 p-4 dark:border-slate-700 dark:bg-slate-900/40">
                        <h3 class="text-sm font-semibold text-slate-900 dark:text-white">Audience</h3>
                        <ul class="mt-3 space-y-1.5 text-sm text-slate-600 dark:text-slate-300">
                            {% for role in selected_module.audience %}
                            <li>{{ role }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                    <div class="rounded-xl border border-slate-200/70 bg-slate-50 p-4 dark:border-slate-700 dark:bg-slate-900/40">
                        <h3 class="text-sm font-semibold text-slate-900 dark:text-white">Required Permissions</h3>
                        <ul class="mt-3 space-y-1.5 text-sm text-slate-600 dark:text-slate-300">
                            {% for perm in selected_module.permissions %}
                            <li><code class="rounded bg-slate-200/80 px-1.5 py-0.5 text-xs dark:bg-slate-700/80">{{ perm }}</code></li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>

                <div class="mt-6 rounded-xl border border-slate-200/70 bg-white p-4 dark:border-slate-700 dark:bg-slate-900/40">
                    <h3 class="text-sm font-semibold text-slate-900 dark:text-white">Quick Links</h3>
                    <div class="mt-3 grid grid-cols-1 gap-2 md:grid-cols-2">
                        {% for link in selected_module.quick_links %}
                        <a href="{{ link.href }}"
                           class="rounded-lg border border-slate-200 px-3 py-2 text-sm text-slate-700 transition-colors hover:bg-slate-50 dark:border-slate-700 dark:text-slate-200 dark:hover:bg-slate-800">
                            {{ link.label }}
                        </a>
                        {% endfor %}
                    </div>
                </div>

                <div class="mt-6 space-y-4">
                    <h3 class="text-sm font-semibold uppercase tracking-wider text-slate-500 dark:text-slate-400">Core Workflows</h3>
                    {% for flow in selected_module.workflows %}
                    <div class="rounded-xl border border-slate-200/70 bg-slate-50 p-4 dark:border-slate-700 dark:bg-slate-900/40">
                        <h4 class="text-sm font-semibold text-slate-900 dark:text-white">{{ flow.title }}</h4>
                        <p class="mt-1 text-sm text-slate-600 dark:text-slate-300">{{ flow.objective }}</p>
                        <ol class="mt-3 space-y-2 text-sm text-slate-700 dark:text-slate-200">
                            {% for step in flow.steps %}
                            <li>{{ loop.index }}. {{ step }}</li>
                            {% endfor %}
                        </ol>
                    </div>
                    {% endfor %}
                </div>

                {% if selected_module.role_playbooks %}
                <div class="mt-6 rounded-xl border border-indigo-200/70 bg-indigo-50 p-4 dark:border-indigo-800/40 dark:bg-indigo-900/10">
                    <h3 class="text-sm font-semibold text-indigo-900 dark:text-indigo-200">Role-Based SOP</h3>
                    <div class="mt-3 space-y-3">
                        {% for playbook in selected_module.role_playbooks %}
                        <div class="rounded-lg border border-indigo-200/70 bg-white p-3 dark:border-indigo-800/50 dark:bg-slate-900/40">
                            <p class="text-sm font-semibold text-indigo-900 dark:text-indigo-200">{{ playbook.role }}</p>
                            <ol class="mt-2 space-y-1.5 text-sm text-slate-700 dark:text-slate-200">
                                {% for step in playbook.steps %}
                                <li>{{ loop.index }}. {{ step }}</li>
                                {% endfor %}
                            </ol>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}

                {% if selected_module.sla_checkpoints or selected_module.completion_criteria %}
                <div class="mt-6 grid grid-cols-1 gap-4 md:grid-cols-2">
                    {% if selected_module.sla_checkpoints %}
                    <div class="rounded-xl border border-rose-200/70 bg-rose-50 p-4 dark:border-rose-800/40 dark:bg-rose-900/10">
                        <h3 class="text-sm font-semibold text-rose-900 dark:text-rose-200">SLA Checkpoints</h3>
                        <ul class="mt-3 space-y-1.5 text-sm text-rose-800 dark:text-rose-200">
                            {% for item in selected_module.sla_checkpoints %}
                            <li>{{ item }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                    {% endif %}
                    {% if selected_module.completion_criteria %}
                    <div class="rounded-xl border border-cyan-200/70 bg-cyan-50 p-4 dark:border-cyan-800/40 dark:bg-cyan-900/10">
                        <h3 class="text-sm font-semibold text-cyan-900 dark:text-cyan-200">Completion Criteria</h3>
                        <ul class="mt-3 space-y-1.5 text-sm text-cyan-800 dark:text-cyan-200">
                            {% for item in selected_module.completion_criteria %}
                            <li>{{ item }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                    {% endif %}
                </div>
                {% endif %}

                <div class="mt-6 grid grid-cols-1 gap-4 md:grid-cols-2">
                    <div class="rounded-xl border border-amber-200/70 bg-amber-50 p-4 dark:border-amber-800/40 dark:bg-amber-900/10">
                        <h3 class="text-sm font-semibold text-amber-900 dark:text-amber-200">Common Mistakes</h3>
                        <ul class="mt-3 space-y-1.5 text-sm text-amber-800 dark:text-amber-200">
                            {% for item in selected_module.pitfalls %}
                            <li>{{ item }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                    <div class="rounded-xl border border-emerald-200/70 bg-emerald-50 p-4 dark:border-emerald-800/40 dark:bg-emerald-900/10">
                        <h3 class="text-sm font-semibold text-emerald-900 dark:text-emerald-200">Troubleshooting</h3>
                        <div class="mt-3 space-y-3">
                            {% for item in selected_module.troubleshooting %}
                            <div class="text-sm text-emerald-800 dark:text-emerald-200">
                                <p class="font-medium">{{ item.issue }}</p>
                                <p class="mt-0.5">{{ item.fix }}</p>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>

                <div class="mt-6 grid grid-cols-1 gap-3 md:grid-cols-2">
                    <a href="/admin/user-guide/full"
                       class="rounded-xl border border-slate-200 bg-white px-4 py-3 text-sm font-medium text-slate-700 transition-colors hover:bg-slate-50 dark:border-slate-700 dark:bg-slate-900 dark:text-slate-200 dark:hover:bg-slate-800">
                        Open Full User Guide
                    </a>
                    <a href="/admin/user-guide"
                       class="rounded-xl border border-sky-200 bg-sky-50 px-4 py-3 text-sm font-medium text-sky-700 transition-colors hover:bg-sky-100 dark:border-sky-700/50 dark:bg-sky-900/20 dark:text-sky-300 dark:hover:bg-sky-900/30">
                        Back to Module List
                    </a>
                </div>
            </div>
        </section>
    </div>
</div>
{% endblock %}

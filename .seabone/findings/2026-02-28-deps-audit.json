[
  {
    "id": "deps-c8-1",
    "severity": "high",
    "category": "deps",
    "file": "pyproject.toml",
    "line": null,
    "status": "open",
    "issue": "idna < 3.7 is vulnerable to CVE-2024-3651 (ReDoS). A specially crafted invalid domain label can trigger catastrophic backtracking in `idna.encode()`, allowing a remote attacker to cause CPU exhaustion via any endpoint that resolves user-supplied hostnames (e.g. outbound webhook targets, CRM channel setup, geocoding calls). The host environment shows idna 3.3 installed (latest 3.11). idna is a transitive dependency of httpx (declared at 0.27.0 in pyproject.toml) and is not pinned anywhere — the resolved version depends entirely on the poetry.lock snapshot.",
    "task": "Add `idna = \">=3.7\"` as an explicit direct dependency in pyproject.toml to force the minimum safe version in all environments. Run `poetry update idna` and regenerate poetry.lock. Confirm resolved version with `poetry show idna`.",
    "auto_fixable": true,
    "effort": "trivial",
    "package": "idna",
    "current_version": "3.3 (host env; unverified in Docker venv)",
    "latest_version": "3.11"
  },
  {
    "id": "deps-c8-2",
    "severity": "high",
    "category": "deps",
    "file": "pyproject.toml",
    "line": null,
    "status": "open",
    "issue": "PyJWT 2.3.0 (transitively pulled in by python-jose 3.3.0) is vulnerable to CVE-2022-29217 (CVSS 7.5) — an algorithm confusion attack where an attacker with knowledge of a public RS256 key can craft a valid HS256 token accepted by PyJWT < 2.4.0. The host environment shows PyJWT 2.3.0 installed (latest 2.11.0). python-jose declares `PyJWT>=2.0.0` with no upper bound, so the resolved version is lock-file dependent. If the Docker venv resolves PyJWT < 2.4.0, every JWT decode call in the auth stack (via python-jose) is potentially exploitable. Note: deps-001 tracks the primary python-jose replacement; this finding tracks the transitively vulnerable PyJWT as an independent risk.",
    "task": "As a short-term stop-gap, add `PyJWT = \">=2.4.0\"` as a direct constraint in pyproject.toml to force the safe version floor. This is secondary to the python-jose → PyJWT migration in deps-001. Confirm resolved version with `poetry show pyjwt`.",
    "auto_fixable": true,
    "effort": "trivial",
    "package": "PyJWT",
    "current_version": "2.3.0 (host env; unverified in Docker venv)",
    "latest_version": "2.11.0"
  },
  {
    "id": "deps-c8-3",
    "severity": "medium",
    "category": "deps",
    "file": "pyproject.toml",
    "line": null,
    "status": "open",
    "issue": "urllib3 < 1.26.17 is vulnerable to CVE-2023-43804 (Cookie header injection via redirect, CVSS 8.1) and CVE-2023-45803 (request body forwarded on 303 redirect, CVSS 4.2). The host environment shows urllib3 1.26.5 (fixed in 1.26.17+ or 2.0.7+). urllib3 is pulled in by `requests` (itself an undeclared transitive dependency — tracked separately in deps-c4-1). Since requests and urllib3 are not pinned in pyproject.toml, the Docker venv may resolve a vulnerable version. The Splynx integration and subscriber sync task both make outbound HTTP calls via requests, and the CRM webhook chain can be triggered with attacker-controlled redirect targets.",
    "task": "Add `urllib3 = \">=1.26.17,<2.0.0 || >=2.0.7\"` as a direct constraint in pyproject.toml alongside the `requests` declaration (deps-c4-1). Run `poetry update urllib3` and verify with `poetry show urllib3`. This also resolves the urllib3 1→2 migration path by explicitly allowing both ranges.",
    "auto_fixable": true,
    "effort": "trivial",
    "package": "urllib3",
    "current_version": "1.26.5 (host env; unverified in Docker venv)",
    "latest_version": "2.6.3"
  },
  {
    "id": "deps-c8-4",
    "severity": "medium",
    "category": "deps",
    "file": "pyproject.toml",
    "line": null,
    "status": "open",
    "issue": "bcrypt 4.0.0 changed its API in ways that silently break passlib 1.7.4's bcrypt backend: bcrypt 4.x uses `checkpw()` and `hashpw()` with a modified handling of the `$2b$` vs `$2y$` prefix, and the library's internal `_bcrypt` binding was rewritten. passlib 1.7.4 has no knowledge of bcrypt 4.x behaviour and may emit incorrect deprecation warnings or silently fall back to a slower pure-Python hash path. bcrypt 5.0.0 (latest) makes further incompatible changes. The host environment shows bcrypt 3.2.0 installed (latest 5.0.0). If the Docker venv resolves bcrypt >= 4.0 (which it will since `passlib[bcrypt]` does not constrain the bcrypt version), password hash verification calls may behave unexpectedly. This is a runtime correctness and latent security risk independent of the passlib maintenance issue in deps-004.",
    "task": "Immediately add `bcrypt = \">=3.2.0,<4.0.0\"` to pyproject.toml as a hard upper-bound constraint to prevent the Docker venv from resolving bcrypt 4.x or 5.x while passlib 1.7.4 is in use. This is a holding fix — the proper resolution is completing the passlib → bcrypt/argon2 migration from deps-004. Verify with `poetry show bcrypt` in the container.",
    "auto_fixable": true,
    "effort": "trivial",
    "package": "bcrypt",
    "current_version": "3.2.0 (host env; constrained by passlib compat)",
    "latest_version": "5.0.0"
  },
  {
    "id": "deps-c8-5",
    "severity": "low",
    "category": "deps",
    "file": "pyproject.toml",
    "line": null,
    "status": "open",
    "issue": "MarkupSafe 2.0.1 is outdated (latest 3.0.3). MarkupSafe is a direct runtime dependency of Jinja2 and handles HTML escaping for the entire template layer. While no standalone CVE exists for MarkupSafe 2.0.1, the 2.x → 3.x line includes stricter `__html__` protocol enforcement, better handling of edge cases in multi-byte unicode escaping, and removal of deprecated Python 2 code paths. Since Jinja2 >= 3.1.6 is already required in pyproject.toml (deps-002 fix), the MarkupSafe constraint should be updated to match. The host environment shows 2.0.1 installed (latest 3.0.3).",
    "task": "Add `markupsafe = \">=2.1.0\"` as an explicit direct dependency in pyproject.toml (Jinja2 3.1.x requires MarkupSafe >= 2.0). Run `poetry update markupsafe` and confirm the resolved version. No code changes required.",
    "auto_fixable": true,
    "effort": "trivial",
    "package": "MarkupSafe",
    "current_version": "2.0.1 (host env; unverified in Docker venv)",
    "latest_version": "3.0.3"
  },
  {
    "id": "deps-c8-6",
    "severity": "low",
    "category": "deps",
    "file": "pyproject.toml",
    "line": null,
    "status": "open",
    "issue": "The project's toolchain versions are significantly outdated: pip 22.0.2 (latest 26.0.1, a 4-major-version gap), poetry 1.8.4 (latest 2.3.2), and poetry-core 1.9.1 (latest 2.3.1). Poetry 2.x introduced a redesigned lockfile format (`poetry.lock` v3), improved resolver performance, and dropped Python 3.8/3.9 support. Running an outdated poetry version increases the risk of dependency resolution bugs and means poetry 2.x lockfile format changes will cause silent incompatibilities when contributors upgrade their local toolchains.",
    "task": "Upgrade the development toolchain: `pip install --upgrade pip poetry`. Update the Dockerfile `RUN pip install poetry==2.3.2` pin if present. Document the required poetry version in a `.python-version` or `README` developer setup section. Test `poetry install` and `poetry lock --no-update` after upgrade to verify lockfile compatibility.",
    "auto_fixable": false,
    "effort": "small",
    "package": "poetry",
    "current_version": "1.8.4",
    "latest_version": "2.3.2"
  }
]
